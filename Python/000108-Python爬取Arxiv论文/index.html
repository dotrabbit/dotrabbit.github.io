<!DOCTYPE html>


  <html class="light page-post">


<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>Python爬取Arxiv论文 | dotrabbit&#39;s lair</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="Python,爬虫,">
  

  

  

  
    <link rel="icon" href="/images/favicon.ico">
  

  <link href="/css/styles.css?v=c114cbeddx" rel="stylesheet">


  
    <link rel="stylesheet" href="/css/personal-style.css">
  

  

  

  


  

</head>
</html>
<body>


  
    <span id="toolbox-mobile" class="toolbox-mobile">导航</span>
  

  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">导航</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a class="CIRCLE" href="/search/" rel="noopener noreferrer" target="_self">
            搜索
          </a>
        </li>
      
        <li class="item-toolbox">
          <a class="CIRCLE" href="/category/" rel="noopener noreferrer" target="_self">
            分类
          </a>
        </li>
      
        <li class="item-toolbox">
          <a class="CIRCLE" href="/tag/" rel="noopener noreferrer" target="_self">
            标签
          </a>
        </li>
      
        <li class="item-toolbox">
          <a class="CIRCLE" href="/link/" rel="noopener noreferrer" target="_self">
            友链
          </a>
        </li>
      
        <li class="item-toolbox">
          <a class="CIRCLE" href="/about/" rel="noopener noreferrer" target="_self">
            关于
          </a>
        </li>
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#脚本"><span class="toc-text">脚本</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#使用"><span class="toc-text">使用</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#BeautifulSoup"><span class="toc-text">BeautifulSoup</span></a></li></ol>
  </div>



<div class="content content-post CENTER">
   <article id="post-000108-Python爬取Arxiv论文" class="article article-type-post" itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">Python爬取Arxiv论文</h1>

    <div class="article-meta">
      <span>
        <i class="icon-calendar"></i>
        <span>2016.06.30</span>
      </span>

      
        <span class="article-author">
          <i class="icon-user"></i>
          <span>dotrabbit</span>
        </span>
      

      
  <span class="article-category">
    <i class="icon-list"></i>
    <a class="article-category-link" href="/categories/Python/">Python</a>
  </span>



      

      
      
    </div>
  </header>

  <div class="article-content">
    
      <p>帮高中兄弟写的爬取论文的脚本，并发送邮件~</p>
<h1 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">keyword = <span class="string">''</span></span><br><span class="line">mailFrom = <span class="string">''</span></span><br><span class="line">password = <span class="string">''</span></span><br><span class="line">smtpserver = <span class="string">''</span></span><br><span class="line">mailTo = <span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"><span class="keyword">from</span> BeautifulSoup <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">url = <span class="string">'https://arxiv.org/list/cs.CV/recent'</span></span><br><span class="line">soup = BeautifulSoup(urllib2.urlopen(url))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> link <span class="keyword">in</span> soup.findAll(<span class="string">'a'</span>):</span><br><span class="line">	<span class="keyword">if</span> link.string == <span class="string">'all'</span>:</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">url = <span class="string">'https://arxiv.org'</span> + link.attrs[<span class="number">0</span>][<span class="number">1</span>]</span><br><span class="line">soup = BeautifulSoup(urllib2.urlopen(url))</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">yesterday = (datetime.datetime.now() - datetime.timedelta(days = <span class="number">1</span>)).strftime(<span class="string">'%a, %-d %b %G'</span>)</span><br><span class="line"><span class="keyword">for</span> h3 <span class="keyword">in</span> soup.findAll(<span class="string">'h3'</span>):</span><br><span class="line">	<span class="keyword">if</span> h3.string == yesterday:</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line">essays = h3.findNextSibling(<span class="string">'dl'</span>).findAll([<span class="string">'dt'</span>, <span class="string">'dd'</span>])</span><br><span class="line">content = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(essays) / <span class="number">2</span>):</span><br><span class="line">	title = essays[<span class="number">2</span> * i + <span class="number">1</span>].find(<span class="string">'div'</span>, attrs=&#123;<span class="string">'class'</span>: <span class="string">'list-title'</span>&#125;).contents[<span class="number">-1</span>].string</span><br><span class="line">	<span class="keyword">if</span> keyword <span class="keyword">in</span> title.lower():</span><br><span class="line">		link = <span class="string">'https://arxiv.org'</span> + essays[<span class="number">2</span> * i].find(<span class="string">'a'</span>, title=<span class="string">'Abstract'</span>).attrs[<span class="number">0</span>][<span class="number">1</span>]</span><br><span class="line">		content += <span class="string">'title: '</span> + title + <span class="string">'\nlink: '</span> + link + <span class="string">'\n\n'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> smtplib</span><br><span class="line"><span class="keyword">from</span> email.mime.text <span class="keyword">import</span> MIMEText  </span><br><span class="line"><span class="keyword">from</span> email.header <span class="keyword">import</span> Header  </span><br><span class="line">  </span><br><span class="line">subject = <span class="string">'arxiv_'</span> + yesterday  </span><br><span class="line">smtpserver = <span class="string">'smtp.sina.com'</span></span><br><span class="line"></span><br><span class="line">msg = MIMEText(content,<span class="string">'plain'</span>,<span class="string">'utf-8'</span>)  </span><br><span class="line">msg[<span class="string">'Subject'</span>] = Header(subject, <span class="string">'utf-8'</span>)  </span><br><span class="line"></span><br><span class="line">smtp = smtplib.SMTP()  </span><br><span class="line">smtp.connect(smtpserver)</span><br><span class="line">smtp.login(mailFrom, password)  </span><br><span class="line">smtp.sendmail(mailFrom, mailTo, msg.as_string())  </span><br><span class="line">smtp.quit()</span><br></pre></td></tr></table></figure>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><p>1、修改getArxiv.py文件：<br>keyword： 需要订阅的关键词<br>mailFrom： 发件邮箱地址<br>password： 发件邮箱密码<br>smtpserver： 发件邮箱smtp服务地址<br>mailTo： 订阅邮箱</p>
<p>2、在本机定时运行：<br>打开terminal，<br>$ crontab -e<br>0 8 <em> </em> * python %getArxiv.py路径%<br>:wq<br>(每天早上8点发送邮件)</p>
<h1 id="BeautifulSoup"><a href="#BeautifulSoup" class="headerlink" title="BeautifulSoup"></a>BeautifulSoup</h1><p>另附BeautifulSoup源码:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br><span class="line">1269</span><br><span class="line">1270</span><br><span class="line">1271</span><br><span class="line">1272</span><br><span class="line">1273</span><br><span class="line">1274</span><br><span class="line">1275</span><br><span class="line">1276</span><br><span class="line">1277</span><br><span class="line">1278</span><br><span class="line">1279</span><br><span class="line">1280</span><br><span class="line">1281</span><br><span class="line">1282</span><br><span class="line">1283</span><br><span class="line">1284</span><br><span class="line">1285</span><br><span class="line">1286</span><br><span class="line">1287</span><br><span class="line">1288</span><br><span class="line">1289</span><br><span class="line">1290</span><br><span class="line">1291</span><br><span class="line">1292</span><br><span class="line">1293</span><br><span class="line">1294</span><br><span class="line">1295</span><br><span class="line">1296</span><br><span class="line">1297</span><br><span class="line">1298</span><br><span class="line">1299</span><br><span class="line">1300</span><br><span class="line">1301</span><br><span class="line">1302</span><br><span class="line">1303</span><br><span class="line">1304</span><br><span class="line">1305</span><br><span class="line">1306</span><br><span class="line">1307</span><br><span class="line">1308</span><br><span class="line">1309</span><br><span class="line">1310</span><br><span class="line">1311</span><br><span class="line">1312</span><br><span class="line">1313</span><br><span class="line">1314</span><br><span class="line">1315</span><br><span class="line">1316</span><br><span class="line">1317</span><br><span class="line">1318</span><br><span class="line">1319</span><br><span class="line">1320</span><br><span class="line">1321</span><br><span class="line">1322</span><br><span class="line">1323</span><br><span class="line">1324</span><br><span class="line">1325</span><br><span class="line">1326</span><br><span class="line">1327</span><br><span class="line">1328</span><br><span class="line">1329</span><br><span class="line">1330</span><br><span class="line">1331</span><br><span class="line">1332</span><br><span class="line">1333</span><br><span class="line">1334</span><br><span class="line">1335</span><br><span class="line">1336</span><br><span class="line">1337</span><br><span class="line">1338</span><br><span class="line">1339</span><br><span class="line">1340</span><br><span class="line">1341</span><br><span class="line">1342</span><br><span class="line">1343</span><br><span class="line">1344</span><br><span class="line">1345</span><br><span class="line">1346</span><br><span class="line">1347</span><br><span class="line">1348</span><br><span class="line">1349</span><br><span class="line">1350</span><br><span class="line">1351</span><br><span class="line">1352</span><br><span class="line">1353</span><br><span class="line">1354</span><br><span class="line">1355</span><br><span class="line">1356</span><br><span class="line">1357</span><br><span class="line">1358</span><br><span class="line">1359</span><br><span class="line">1360</span><br><span class="line">1361</span><br><span class="line">1362</span><br><span class="line">1363</span><br><span class="line">1364</span><br><span class="line">1365</span><br><span class="line">1366</span><br><span class="line">1367</span><br><span class="line">1368</span><br><span class="line">1369</span><br><span class="line">1370</span><br><span class="line">1371</span><br><span class="line">1372</span><br><span class="line">1373</span><br><span class="line">1374</span><br><span class="line">1375</span><br><span class="line">1376</span><br><span class="line">1377</span><br><span class="line">1378</span><br><span class="line">1379</span><br><span class="line">1380</span><br><span class="line">1381</span><br><span class="line">1382</span><br><span class="line">1383</span><br><span class="line">1384</span><br><span class="line">1385</span><br><span class="line">1386</span><br><span class="line">1387</span><br><span class="line">1388</span><br><span class="line">1389</span><br><span class="line">1390</span><br><span class="line">1391</span><br><span class="line">1392</span><br><span class="line">1393</span><br><span class="line">1394</span><br><span class="line">1395</span><br><span class="line">1396</span><br><span class="line">1397</span><br><span class="line">1398</span><br><span class="line">1399</span><br><span class="line">1400</span><br><span class="line">1401</span><br><span class="line">1402</span><br><span class="line">1403</span><br><span class="line">1404</span><br><span class="line">1405</span><br><span class="line">1406</span><br><span class="line">1407</span><br><span class="line">1408</span><br><span class="line">1409</span><br><span class="line">1410</span><br><span class="line">1411</span><br><span class="line">1412</span><br><span class="line">1413</span><br><span class="line">1414</span><br><span class="line">1415</span><br><span class="line">1416</span><br><span class="line">1417</span><br><span class="line">1418</span><br><span class="line">1419</span><br><span class="line">1420</span><br><span class="line">1421</span><br><span class="line">1422</span><br><span class="line">1423</span><br><span class="line">1424</span><br><span class="line">1425</span><br><span class="line">1426</span><br><span class="line">1427</span><br><span class="line">1428</span><br><span class="line">1429</span><br><span class="line">1430</span><br><span class="line">1431</span><br><span class="line">1432</span><br><span class="line">1433</span><br><span class="line">1434</span><br><span class="line">1435</span><br><span class="line">1436</span><br><span class="line">1437</span><br><span class="line">1438</span><br><span class="line">1439</span><br><span class="line">1440</span><br><span class="line">1441</span><br><span class="line">1442</span><br><span class="line">1443</span><br><span class="line">1444</span><br><span class="line">1445</span><br><span class="line">1446</span><br><span class="line">1447</span><br><span class="line">1448</span><br><span class="line">1449</span><br><span class="line">1450</span><br><span class="line">1451</span><br><span class="line">1452</span><br><span class="line">1453</span><br><span class="line">1454</span><br><span class="line">1455</span><br><span class="line">1456</span><br><span class="line">1457</span><br><span class="line">1458</span><br><span class="line">1459</span><br><span class="line">1460</span><br><span class="line">1461</span><br><span class="line">1462</span><br><span class="line">1463</span><br><span class="line">1464</span><br><span class="line">1465</span><br><span class="line">1466</span><br><span class="line">1467</span><br><span class="line">1468</span><br><span class="line">1469</span><br><span class="line">1470</span><br><span class="line">1471</span><br><span class="line">1472</span><br><span class="line">1473</span><br><span class="line">1474</span><br><span class="line">1475</span><br><span class="line">1476</span><br><span class="line">1477</span><br><span class="line">1478</span><br><span class="line">1479</span><br><span class="line">1480</span><br><span class="line">1481</span><br><span class="line">1482</span><br><span class="line">1483</span><br><span class="line">1484</span><br><span class="line">1485</span><br><span class="line">1486</span><br><span class="line">1487</span><br><span class="line">1488</span><br><span class="line">1489</span><br><span class="line">1490</span><br><span class="line">1491</span><br><span class="line">1492</span><br><span class="line">1493</span><br><span class="line">1494</span><br><span class="line">1495</span><br><span class="line">1496</span><br><span class="line">1497</span><br><span class="line">1498</span><br><span class="line">1499</span><br><span class="line">1500</span><br><span class="line">1501</span><br><span class="line">1502</span><br><span class="line">1503</span><br><span class="line">1504</span><br><span class="line">1505</span><br><span class="line">1506</span><br><span class="line">1507</span><br><span class="line">1508</span><br><span class="line">1509</span><br><span class="line">1510</span><br><span class="line">1511</span><br><span class="line">1512</span><br><span class="line">1513</span><br><span class="line">1514</span><br><span class="line">1515</span><br><span class="line">1516</span><br><span class="line">1517</span><br><span class="line">1518</span><br><span class="line">1519</span><br><span class="line">1520</span><br><span class="line">1521</span><br><span class="line">1522</span><br><span class="line">1523</span><br><span class="line">1524</span><br><span class="line">1525</span><br><span class="line">1526</span><br><span class="line">1527</span><br><span class="line">1528</span><br><span class="line">1529</span><br><span class="line">1530</span><br><span class="line">1531</span><br><span class="line">1532</span><br><span class="line">1533</span><br><span class="line">1534</span><br><span class="line">1535</span><br><span class="line">1536</span><br><span class="line">1537</span><br><span class="line">1538</span><br><span class="line">1539</span><br><span class="line">1540</span><br><span class="line">1541</span><br><span class="line">1542</span><br><span class="line">1543</span><br><span class="line">1544</span><br><span class="line">1545</span><br><span class="line">1546</span><br><span class="line">1547</span><br><span class="line">1548</span><br><span class="line">1549</span><br><span class="line">1550</span><br><span class="line">1551</span><br><span class="line">1552</span><br><span class="line">1553</span><br><span class="line">1554</span><br><span class="line">1555</span><br><span class="line">1556</span><br><span class="line">1557</span><br><span class="line">1558</span><br><span class="line">1559</span><br><span class="line">1560</span><br><span class="line">1561</span><br><span class="line">1562</span><br><span class="line">1563</span><br><span class="line">1564</span><br><span class="line">1565</span><br><span class="line">1566</span><br><span class="line">1567</span><br><span class="line">1568</span><br><span class="line">1569</span><br><span class="line">1570</span><br><span class="line">1571</span><br><span class="line">1572</span><br><span class="line">1573</span><br><span class="line">1574</span><br><span class="line">1575</span><br><span class="line">1576</span><br><span class="line">1577</span><br><span class="line">1578</span><br><span class="line">1579</span><br><span class="line">1580</span><br><span class="line">1581</span><br><span class="line">1582</span><br><span class="line">1583</span><br><span class="line">1584</span><br><span class="line">1585</span><br><span class="line">1586</span><br><span class="line">1587</span><br><span class="line">1588</span><br><span class="line">1589</span><br><span class="line">1590</span><br><span class="line">1591</span><br><span class="line">1592</span><br><span class="line">1593</span><br><span class="line">1594</span><br><span class="line">1595</span><br><span class="line">1596</span><br><span class="line">1597</span><br><span class="line">1598</span><br><span class="line">1599</span><br><span class="line">1600</span><br><span class="line">1601</span><br><span class="line">1602</span><br><span class="line">1603</span><br><span class="line">1604</span><br><span class="line">1605</span><br><span class="line">1606</span><br><span class="line">1607</span><br><span class="line">1608</span><br><span class="line">1609</span><br><span class="line">1610</span><br><span class="line">1611</span><br><span class="line">1612</span><br><span class="line">1613</span><br><span class="line">1614</span><br><span class="line">1615</span><br><span class="line">1616</span><br><span class="line">1617</span><br><span class="line">1618</span><br><span class="line">1619</span><br><span class="line">1620</span><br><span class="line">1621</span><br><span class="line">1622</span><br><span class="line">1623</span><br><span class="line">1624</span><br><span class="line">1625</span><br><span class="line">1626</span><br><span class="line">1627</span><br><span class="line">1628</span><br><span class="line">1629</span><br><span class="line">1630</span><br><span class="line">1631</span><br><span class="line">1632</span><br><span class="line">1633</span><br><span class="line">1634</span><br><span class="line">1635</span><br><span class="line">1636</span><br><span class="line">1637</span><br><span class="line">1638</span><br><span class="line">1639</span><br><span class="line">1640</span><br><span class="line">1641</span><br><span class="line">1642</span><br><span class="line">1643</span><br><span class="line">1644</span><br><span class="line">1645</span><br><span class="line">1646</span><br><span class="line">1647</span><br><span class="line">1648</span><br><span class="line">1649</span><br><span class="line">1650</span><br><span class="line">1651</span><br><span class="line">1652</span><br><span class="line">1653</span><br><span class="line">1654</span><br><span class="line">1655</span><br><span class="line">1656</span><br><span class="line">1657</span><br><span class="line">1658</span><br><span class="line">1659</span><br><span class="line">1660</span><br><span class="line">1661</span><br><span class="line">1662</span><br><span class="line">1663</span><br><span class="line">1664</span><br><span class="line">1665</span><br><span class="line">1666</span><br><span class="line">1667</span><br><span class="line">1668</span><br><span class="line">1669</span><br><span class="line">1670</span><br><span class="line">1671</span><br><span class="line">1672</span><br><span class="line">1673</span><br><span class="line">1674</span><br><span class="line">1675</span><br><span class="line">1676</span><br><span class="line">1677</span><br><span class="line">1678</span><br><span class="line">1679</span><br><span class="line">1680</span><br><span class="line">1681</span><br><span class="line">1682</span><br><span class="line">1683</span><br><span class="line">1684</span><br><span class="line">1685</span><br><span class="line">1686</span><br><span class="line">1687</span><br><span class="line">1688</span><br><span class="line">1689</span><br><span class="line">1690</span><br><span class="line">1691</span><br><span class="line">1692</span><br><span class="line">1693</span><br><span class="line">1694</span><br><span class="line">1695</span><br><span class="line">1696</span><br><span class="line">1697</span><br><span class="line">1698</span><br><span class="line">1699</span><br><span class="line">1700</span><br><span class="line">1701</span><br><span class="line">1702</span><br><span class="line">1703</span><br><span class="line">1704</span><br><span class="line">1705</span><br><span class="line">1706</span><br><span class="line">1707</span><br><span class="line">1708</span><br><span class="line">1709</span><br><span class="line">1710</span><br><span class="line">1711</span><br><span class="line">1712</span><br><span class="line">1713</span><br><span class="line">1714</span><br><span class="line">1715</span><br><span class="line">1716</span><br><span class="line">1717</span><br><span class="line">1718</span><br><span class="line">1719</span><br><span class="line">1720</span><br><span class="line">1721</span><br><span class="line">1722</span><br><span class="line">1723</span><br><span class="line">1724</span><br><span class="line">1725</span><br><span class="line">1726</span><br><span class="line">1727</span><br><span class="line">1728</span><br><span class="line">1729</span><br><span class="line">1730</span><br><span class="line">1731</span><br><span class="line">1732</span><br><span class="line">1733</span><br><span class="line">1734</span><br><span class="line">1735</span><br><span class="line">1736</span><br><span class="line">1737</span><br><span class="line">1738</span><br><span class="line">1739</span><br><span class="line">1740</span><br><span class="line">1741</span><br><span class="line">1742</span><br><span class="line">1743</span><br><span class="line">1744</span><br><span class="line">1745</span><br><span class="line">1746</span><br><span class="line">1747</span><br><span class="line">1748</span><br><span class="line">1749</span><br><span class="line">1750</span><br><span class="line">1751</span><br><span class="line">1752</span><br><span class="line">1753</span><br><span class="line">1754</span><br><span class="line">1755</span><br><span class="line">1756</span><br><span class="line">1757</span><br><span class="line">1758</span><br><span class="line">1759</span><br><span class="line">1760</span><br><span class="line">1761</span><br><span class="line">1762</span><br><span class="line">1763</span><br><span class="line">1764</span><br><span class="line">1765</span><br><span class="line">1766</span><br><span class="line">1767</span><br><span class="line">1768</span><br><span class="line">1769</span><br><span class="line">1770</span><br><span class="line">1771</span><br><span class="line">1772</span><br><span class="line">1773</span><br><span class="line">1774</span><br><span class="line">1775</span><br><span class="line">1776</span><br><span class="line">1777</span><br><span class="line">1778</span><br><span class="line">1779</span><br><span class="line">1780</span><br><span class="line">1781</span><br><span class="line">1782</span><br><span class="line">1783</span><br><span class="line">1784</span><br><span class="line">1785</span><br><span class="line">1786</span><br><span class="line">1787</span><br><span class="line">1788</span><br><span class="line">1789</span><br><span class="line">1790</span><br><span class="line">1791</span><br><span class="line">1792</span><br><span class="line">1793</span><br><span class="line">1794</span><br><span class="line">1795</span><br><span class="line">1796</span><br><span class="line">1797</span><br><span class="line">1798</span><br><span class="line">1799</span><br><span class="line">1800</span><br><span class="line">1801</span><br><span class="line">1802</span><br><span class="line">1803</span><br><span class="line">1804</span><br><span class="line">1805</span><br><span class="line">1806</span><br><span class="line">1807</span><br><span class="line">1808</span><br><span class="line">1809</span><br><span class="line">1810</span><br><span class="line">1811</span><br><span class="line">1812</span><br><span class="line">1813</span><br><span class="line">1814</span><br><span class="line">1815</span><br><span class="line">1816</span><br><span class="line">1817</span><br><span class="line">1818</span><br><span class="line">1819</span><br><span class="line">1820</span><br><span class="line">1821</span><br><span class="line">1822</span><br><span class="line">1823</span><br><span class="line">1824</span><br><span class="line">1825</span><br><span class="line">1826</span><br><span class="line">1827</span><br><span class="line">1828</span><br><span class="line">1829</span><br><span class="line">1830</span><br><span class="line">1831</span><br><span class="line">1832</span><br><span class="line">1833</span><br><span class="line">1834</span><br><span class="line">1835</span><br><span class="line">1836</span><br><span class="line">1837</span><br><span class="line">1838</span><br><span class="line">1839</span><br><span class="line">1840</span><br><span class="line">1841</span><br><span class="line">1842</span><br><span class="line">1843</span><br><span class="line">1844</span><br><span class="line">1845</span><br><span class="line">1846</span><br><span class="line">1847</span><br><span class="line">1848</span><br><span class="line">1849</span><br><span class="line">1850</span><br><span class="line">1851</span><br><span class="line">1852</span><br><span class="line">1853</span><br><span class="line">1854</span><br><span class="line">1855</span><br><span class="line">1856</span><br><span class="line">1857</span><br><span class="line">1858</span><br><span class="line">1859</span><br><span class="line">1860</span><br><span class="line">1861</span><br><span class="line">1862</span><br><span class="line">1863</span><br><span class="line">1864</span><br><span class="line">1865</span><br><span class="line">1866</span><br><span class="line">1867</span><br><span class="line">1868</span><br><span class="line">1869</span><br><span class="line">1870</span><br><span class="line">1871</span><br><span class="line">1872</span><br><span class="line">1873</span><br><span class="line">1874</span><br><span class="line">1875</span><br><span class="line">1876</span><br><span class="line">1877</span><br><span class="line">1878</span><br><span class="line">1879</span><br><span class="line">1880</span><br><span class="line">1881</span><br><span class="line">1882</span><br><span class="line">1883</span><br><span class="line">1884</span><br><span class="line">1885</span><br><span class="line">1886</span><br><span class="line">1887</span><br><span class="line">1888</span><br><span class="line">1889</span><br><span class="line">1890</span><br><span class="line">1891</span><br><span class="line">1892</span><br><span class="line">1893</span><br><span class="line">1894</span><br><span class="line">1895</span><br><span class="line">1896</span><br><span class="line">1897</span><br><span class="line">1898</span><br><span class="line">1899</span><br><span class="line">1900</span><br><span class="line">1901</span><br><span class="line">1902</span><br><span class="line">1903</span><br><span class="line">1904</span><br><span class="line">1905</span><br><span class="line">1906</span><br><span class="line">1907</span><br><span class="line">1908</span><br><span class="line">1909</span><br><span class="line">1910</span><br><span class="line">1911</span><br><span class="line">1912</span><br><span class="line">1913</span><br><span class="line">1914</span><br><span class="line">1915</span><br><span class="line">1916</span><br><span class="line">1917</span><br><span class="line">1918</span><br><span class="line">1919</span><br><span class="line">1920</span><br><span class="line">1921</span><br><span class="line">1922</span><br><span class="line">1923</span><br><span class="line">1924</span><br><span class="line">1925</span><br><span class="line">1926</span><br><span class="line">1927</span><br><span class="line">1928</span><br><span class="line">1929</span><br><span class="line">1930</span><br><span class="line">1931</span><br><span class="line">1932</span><br><span class="line">1933</span><br><span class="line">1934</span><br><span class="line">1935</span><br><span class="line">1936</span><br><span class="line">1937</span><br><span class="line">1938</span><br><span class="line">1939</span><br><span class="line">1940</span><br><span class="line">1941</span><br><span class="line">1942</span><br><span class="line">1943</span><br><span class="line">1944</span><br><span class="line">1945</span><br><span class="line">1946</span><br><span class="line">1947</span><br><span class="line">1948</span><br><span class="line">1949</span><br><span class="line">1950</span><br><span class="line">1951</span><br><span class="line">1952</span><br><span class="line">1953</span><br><span class="line">1954</span><br><span class="line">1955</span><br><span class="line">1956</span><br><span class="line">1957</span><br><span class="line">1958</span><br><span class="line">1959</span><br><span class="line">1960</span><br><span class="line">1961</span><br><span class="line">1962</span><br><span class="line">1963</span><br><span class="line">1964</span><br><span class="line">1965</span><br><span class="line">1966</span><br><span class="line">1967</span><br><span class="line">1968</span><br><span class="line">1969</span><br><span class="line">1970</span><br><span class="line">1971</span><br><span class="line">1972</span><br><span class="line">1973</span><br><span class="line">1974</span><br><span class="line">1975</span><br><span class="line">1976</span><br><span class="line">1977</span><br><span class="line">1978</span><br><span class="line">1979</span><br><span class="line">1980</span><br><span class="line">1981</span><br><span class="line">1982</span><br><span class="line">1983</span><br><span class="line">1984</span><br><span class="line">1985</span><br><span class="line">1986</span><br><span class="line">1987</span><br><span class="line">1988</span><br><span class="line">1989</span><br><span class="line">1990</span><br><span class="line">1991</span><br><span class="line">1992</span><br><span class="line">1993</span><br><span class="line">1994</span><br><span class="line">1995</span><br><span class="line">1996</span><br><span class="line">1997</span><br><span class="line">1998</span><br><span class="line">1999</span><br><span class="line">2000</span><br><span class="line">2001</span><br><span class="line">2002</span><br><span class="line">2003</span><br><span class="line">2004</span><br><span class="line">2005</span><br><span class="line">2006</span><br><span class="line">2007</span><br><span class="line">2008</span><br><span class="line">2009</span><br><span class="line">2010</span><br><span class="line">2011</span><br><span class="line">2012</span><br><span class="line">2013</span><br><span class="line">2014</span><br><span class="line">2015</span><br><span class="line">2016</span><br><span class="line">2017</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""Beautiful Soup</span></span><br><span class="line"><span class="string">Elixir and Tonic</span></span><br><span class="line"><span class="string">"The Screen-Scraper's Friend"</span></span><br><span class="line"><span class="string">http://www.crummy.com/software/BeautifulSoup/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Beautiful Soup parses a (possibly invalid) XML or HTML document into a</span></span><br><span class="line"><span class="string">tree representation. It provides methods and Pythonic idioms that make</span></span><br><span class="line"><span class="string">it easy to navigate, search, and modify the tree.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">A well-formed XML/HTML document yields a well-formed data</span></span><br><span class="line"><span class="string">structure. An ill-formed XML/HTML document yields a correspondingly</span></span><br><span class="line"><span class="string">ill-formed data structure. If your document is only locally</span></span><br><span class="line"><span class="string">well-formed, you can use this library to find and process the</span></span><br><span class="line"><span class="string">well-formed part of it.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Beautiful Soup works with Python 2.2 and up. It has no external</span></span><br><span class="line"><span class="string">dependencies, but you'll have more success at converting data to UTF-8</span></span><br><span class="line"><span class="string">if you also install these three packages:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">* chardet, for auto-detecting character encodings</span></span><br><span class="line"><span class="string">  http://chardet.feedparser.org/</span></span><br><span class="line"><span class="string">* cjkcodecs and iconv_codec, which add more encodings to the ones supported</span></span><br><span class="line"><span class="string">  by stock Python.</span></span><br><span class="line"><span class="string">  http://cjkpython.i18n.org/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Beautiful Soup defines classes for two main parsing strategies:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> * BeautifulStoneSoup, for parsing XML, SGML, or your domain-specific</span></span><br><span class="line"><span class="string">   language that kind of looks like XML.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> * BeautifulSoup, for parsing run-of-the-mill HTML code, be it valid</span></span><br><span class="line"><span class="string">   or invalid. This class has web browser-like heuristics for</span></span><br><span class="line"><span class="string">   obtaining a sensible parse tree in the face of common HTML errors.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Beautiful Soup also defines a class (UnicodeDammit) for autodetecting</span></span><br><span class="line"><span class="string">the encoding of an HTML or XML document, and converting it to</span></span><br><span class="line"><span class="string">Unicode. Much of this code is taken from Mark Pilgrim's Universal Feed Parser.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">For more than you ever wanted to know about Beautiful Soup, see the</span></span><br><span class="line"><span class="string">documentation:</span></span><br><span class="line"><span class="string">http://www.crummy.com/software/BeautifulSoup/documentation.html</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Here, have some legalese:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Copyright (c) 2004-2010, Leonard Richardson</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">All rights reserved.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Redistribution and use in source and binary forms, with or without</span></span><br><span class="line"><span class="string">modification, are permitted provided that the following conditions are</span></span><br><span class="line"><span class="string">met:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  * Redistributions of source code must retain the above copyright</span></span><br><span class="line"><span class="string">    notice, this list of conditions and the following disclaimer.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  * Redistributions in binary form must reproduce the above</span></span><br><span class="line"><span class="string">    copyright notice, this list of conditions and the following</span></span><br><span class="line"><span class="string">    disclaimer in the documentation and/or other materials provided</span></span><br><span class="line"><span class="string">    with the distribution.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  * Neither the name of the the Beautiful Soup Consortium and All</span></span><br><span class="line"><span class="string">    Night Kosher Bakery nor the names of its contributors may be</span></span><br><span class="line"><span class="string">    used to endorse or promote products derived from this software</span></span><br><span class="line"><span class="string">    without specific prior written permission.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span></span><br><span class="line"><span class="string">"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span></span><br><span class="line"><span class="string">LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span></span><br><span class="line"><span class="string">A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR</span></span><br><span class="line"><span class="string">CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,</span></span><br><span class="line"><span class="string">EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,</span></span><br><span class="line"><span class="string">PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR</span></span><br><span class="line"><span class="string">PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF</span></span><br><span class="line"><span class="string">LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING</span></span><br><span class="line"><span class="string">NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span></span><br><span class="line"><span class="string">SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE, DAMMIT.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> generators</span><br><span class="line"></span><br><span class="line">__author__ = <span class="string">"Leonard Richardson (leonardr@segfault.org)"</span></span><br><span class="line">__version__ = <span class="string">"3.2.1"</span></span><br><span class="line">__copyright__ = <span class="string">"Copyright (c) 2004-2012 Leonard Richardson"</span></span><br><span class="line">__license__ = <span class="string">"New-style BSD"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sgmllib <span class="keyword">import</span> SGMLParser, SGMLParseError</span><br><span class="line"><span class="keyword">import</span> codecs</span><br><span class="line"><span class="keyword">import</span> markupbase</span><br><span class="line"><span class="keyword">import</span> types</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> sgmllib</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">  <span class="keyword">from</span> htmlentitydefs <span class="keyword">import</span> name2codepoint</span><br><span class="line"><span class="keyword">except</span> ImportError:</span><br><span class="line">  name2codepoint = &#123;&#125;</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    set</span><br><span class="line"><span class="keyword">except</span> NameError:</span><br><span class="line">    <span class="keyword">from</span> sets <span class="keyword">import</span> Set <span class="keyword">as</span> set</span><br><span class="line"></span><br><span class="line"><span class="comment">#These hacks make Beautiful Soup able to parse XML with namespaces</span></span><br><span class="line">sgmllib.tagfind = re.compile(<span class="string">'[a-zA-Z][-_.:a-zA-Z0-9]*'</span>)</span><br><span class="line">markupbase._declname_match = re.compile(<span class="string">r'[a-zA-Z][-_.:a-zA-Z0-9]*\s*'</span>).match</span><br><span class="line"></span><br><span class="line">DEFAULT_OUTPUT_ENCODING = <span class="string">"utf-8"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_match_css_class</span><span class="params">(str)</span>:</span></span><br><span class="line">    <span class="string">"""Build a RE to match the given CSS class."""</span></span><br><span class="line">    <span class="keyword">return</span> re.compile(<span class="string">r"(^|.*\s)%s($|\s)"</span> % str)</span><br><span class="line"></span><br><span class="line"><span class="comment"># First, the classes that represent markup elements.</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PageElement</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""Contains the navigational information for some part of the page</span></span><br><span class="line"><span class="string">    (either a tag or a piece of text)"""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_invert</span><span class="params">(h)</span>:</span></span><br><span class="line">        <span class="string">"Cheap function to invert a hash."</span></span><br><span class="line">        i = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> k,v <span class="keyword">in</span> h.items():</span><br><span class="line">            i[v] = k</span><br><span class="line">        <span class="keyword">return</span> i</span><br><span class="line"></span><br><span class="line">    XML_ENTITIES_TO_SPECIAL_CHARS = &#123; <span class="string">"apos"</span> : <span class="string">"'"</span>,</span><br><span class="line">                                      <span class="string">"quot"</span> : <span class="string">'"'</span>,</span><br><span class="line">                                      <span class="string">"amp"</span> : <span class="string">"&amp;"</span>,</span><br><span class="line">                                      <span class="string">"lt"</span> : <span class="string">"&lt;"</span>,</span><br><span class="line">                                      <span class="string">"gt"</span> : <span class="string">"&gt;"</span> &#125;</span><br><span class="line"></span><br><span class="line">    XML_SPECIAL_CHARS_TO_ENTITIES = _invert(XML_ENTITIES_TO_SPECIAL_CHARS)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setup</span><span class="params">(self, parent=None, previous=None)</span>:</span></span><br><span class="line">        <span class="string">"""Sets up the initial relations between this element and</span></span><br><span class="line"><span class="string">        other elements."""</span></span><br><span class="line">        self.parent = parent</span><br><span class="line">        self.previous = previous</span><br><span class="line">        self.next = <span class="keyword">None</span></span><br><span class="line">        self.previousSibling = <span class="keyword">None</span></span><br><span class="line">        self.nextSibling = <span class="keyword">None</span></span><br><span class="line">        <span class="keyword">if</span> self.parent <span class="keyword">and</span> self.parent.contents:</span><br><span class="line">            self.previousSibling = self.parent.contents[<span class="number">-1</span>]</span><br><span class="line">            self.previousSibling.nextSibling = self</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">replaceWith</span><span class="params">(self, replaceWith)</span>:</span></span><br><span class="line">        oldParent = self.parent</span><br><span class="line">        myIndex = self.parent.index(self)</span><br><span class="line">        <span class="keyword">if</span> hasattr(replaceWith, <span class="string">"parent"</span>)\</span><br><span class="line">                  <span class="keyword">and</span> replaceWith.parent <span class="keyword">is</span> self.parent:</span><br><span class="line">            <span class="comment"># We're replacing this element with one of its siblings.</span></span><br><span class="line">            index = replaceWith.parent.index(replaceWith)</span><br><span class="line">            <span class="keyword">if</span> index <span class="keyword">and</span> index &lt; myIndex:</span><br><span class="line">                <span class="comment"># Furthermore, it comes before this element. That</span></span><br><span class="line">                <span class="comment"># means that when we extract it, the index of this</span></span><br><span class="line">                <span class="comment"># element will change.</span></span><br><span class="line">                myIndex = myIndex - <span class="number">1</span></span><br><span class="line">        self.extract()</span><br><span class="line">        oldParent.insert(myIndex, replaceWith)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">replaceWithChildren</span><span class="params">(self)</span>:</span></span><br><span class="line">        myParent = self.parent</span><br><span class="line">        myIndex = self.parent.index(self)</span><br><span class="line">        self.extract()</span><br><span class="line">        reversedChildren = list(self.contents)</span><br><span class="line">        reversedChildren.reverse()</span><br><span class="line">        <span class="keyword">for</span> child <span class="keyword">in</span> reversedChildren:</span><br><span class="line">            myParent.insert(myIndex, child)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">extract</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""Destructively rips this element out of the tree."""</span></span><br><span class="line">        <span class="keyword">if</span> self.parent:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">del</span> self.parent.contents[self.parent.index(self)]</span><br><span class="line">            <span class="keyword">except</span> ValueError:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#Find the two elements that would be next to each other if</span></span><br><span class="line">        <span class="comment">#this element (and any children) hadn't been parsed. Connect</span></span><br><span class="line">        <span class="comment">#the two.</span></span><br><span class="line">        lastChild = self._lastRecursiveChild()</span><br><span class="line">        nextElement = lastChild.next</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.previous:</span><br><span class="line">            self.previous.next = nextElement</span><br><span class="line">        <span class="keyword">if</span> nextElement:</span><br><span class="line">            nextElement.previous = self.previous</span><br><span class="line">        self.previous = <span class="keyword">None</span></span><br><span class="line">        lastChild.next = <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line">        self.parent = <span class="keyword">None</span></span><br><span class="line">        <span class="keyword">if</span> self.previousSibling:</span><br><span class="line">            self.previousSibling.nextSibling = self.nextSibling</span><br><span class="line">        <span class="keyword">if</span> self.nextSibling:</span><br><span class="line">            self.nextSibling.previousSibling = self.previousSibling</span><br><span class="line">        self.previousSibling = self.nextSibling = <span class="keyword">None</span></span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_lastRecursiveChild</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"Finds the last element beneath this object to be parsed."</span></span><br><span class="line">        lastChild = self</span><br><span class="line">        <span class="keyword">while</span> hasattr(lastChild, <span class="string">'contents'</span>) <span class="keyword">and</span> lastChild.contents:</span><br><span class="line">            lastChild = lastChild.contents[<span class="number">-1</span>]</span><br><span class="line">        <span class="keyword">return</span> lastChild</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert</span><span class="params">(self, position, newChild)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(newChild, basestring) \</span><br><span class="line">            <span class="keyword">and</span> <span class="keyword">not</span> isinstance(newChild, NavigableString):</span><br><span class="line">            newChild = NavigableString(newChild)</span><br><span class="line"></span><br><span class="line">        position =  min(position, len(self.contents))</span><br><span class="line">        <span class="keyword">if</span> hasattr(newChild, <span class="string">'parent'</span>) <span class="keyword">and</span> newChild.parent <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">            <span class="comment"># We're 'inserting' an element that's already one</span></span><br><span class="line">            <span class="comment"># of this object's children.</span></span><br><span class="line">            <span class="keyword">if</span> newChild.parent <span class="keyword">is</span> self:</span><br><span class="line">                index = self.index(newChild)</span><br><span class="line">                <span class="keyword">if</span> index &gt; position:</span><br><span class="line">                    <span class="comment"># Furthermore we're moving it further down the</span></span><br><span class="line">                    <span class="comment"># list of this object's children. That means that</span></span><br><span class="line">                    <span class="comment"># when we extract this element, our target index</span></span><br><span class="line">                    <span class="comment"># will jump down one.</span></span><br><span class="line">                    position = position - <span class="number">1</span></span><br><span class="line">            newChild.extract()</span><br><span class="line"></span><br><span class="line">        newChild.parent = self</span><br><span class="line">        previousChild = <span class="keyword">None</span></span><br><span class="line">        <span class="keyword">if</span> position == <span class="number">0</span>:</span><br><span class="line">            newChild.previousSibling = <span class="keyword">None</span></span><br><span class="line">            newChild.previous = self</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            previousChild = self.contents[position<span class="number">-1</span>]</span><br><span class="line">            newChild.previousSibling = previousChild</span><br><span class="line">            newChild.previousSibling.nextSibling = newChild</span><br><span class="line">            newChild.previous = previousChild._lastRecursiveChild()</span><br><span class="line">        <span class="keyword">if</span> newChild.previous:</span><br><span class="line">            newChild.previous.next = newChild</span><br><span class="line"></span><br><span class="line">        newChildsLastElement = newChild._lastRecursiveChild()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> position &gt;= len(self.contents):</span><br><span class="line">            newChild.nextSibling = <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line">            parent = self</span><br><span class="line">            parentsNextSibling = <span class="keyword">None</span></span><br><span class="line">            <span class="keyword">while</span> <span class="keyword">not</span> parentsNextSibling:</span><br><span class="line">                parentsNextSibling = parent.nextSibling</span><br><span class="line">                parent = parent.parent</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> parent: <span class="comment"># This is the last element in the document.</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> parentsNextSibling:</span><br><span class="line">                newChildsLastElement.next = parentsNextSibling</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                newChildsLastElement.next = <span class="keyword">None</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            nextChild = self.contents[position]</span><br><span class="line">            newChild.nextSibling = nextChild</span><br><span class="line">            <span class="keyword">if</span> newChild.nextSibling:</span><br><span class="line">                newChild.nextSibling.previousSibling = newChild</span><br><span class="line">            newChildsLastElement.next = nextChild</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> newChildsLastElement.next:</span><br><span class="line">            newChildsLastElement.next.previous = newChildsLastElement</span><br><span class="line">        self.contents.insert(position, newChild)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">append</span><span class="params">(self, tag)</span>:</span></span><br><span class="line">        <span class="string">"""Appends the given tag to the contents of this tag."""</span></span><br><span class="line">        self.insert(len(self.contents), tag)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findNext</span><span class="params">(self, name=None, attrs=&#123;&#125;, text=None, **kwargs)</span>:</span></span><br><span class="line">        <span class="string">"""Returns the first item that matches the given criteria and</span></span><br><span class="line"><span class="string">        appears after this Tag in the document."""</span></span><br><span class="line">        <span class="keyword">return</span> self._findOne(self.findAllNext, name, attrs, text, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findAllNext</span><span class="params">(self, name=None, attrs=&#123;&#125;, text=None, limit=None,</span></span></span><br><span class="line"><span class="function"><span class="params">                    **kwargs)</span>:</span></span><br><span class="line">        <span class="string">"""Returns all items that match the given criteria and appear</span></span><br><span class="line"><span class="string">        after this Tag in the document."""</span></span><br><span class="line">        <span class="keyword">return</span> self._findAll(name, attrs, text, limit, self.nextGenerator,</span><br><span class="line">                             **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findNextSibling</span><span class="params">(self, name=None, attrs=&#123;&#125;, text=None, **kwargs)</span>:</span></span><br><span class="line">        <span class="string">"""Returns the closest sibling to this Tag that matches the</span></span><br><span class="line"><span class="string">        given criteria and appears after this Tag in the document."""</span></span><br><span class="line">        <span class="keyword">return</span> self._findOne(self.findNextSiblings, name, attrs, text,</span><br><span class="line">                             **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findNextSiblings</span><span class="params">(self, name=None, attrs=&#123;&#125;, text=None, limit=None,</span></span></span><br><span class="line"><span class="function"><span class="params">                         **kwargs)</span>:</span></span><br><span class="line">        <span class="string">"""Returns the siblings of this Tag that match the given</span></span><br><span class="line"><span class="string">        criteria and appear after this Tag in the document."""</span></span><br><span class="line">        <span class="keyword">return</span> self._findAll(name, attrs, text, limit,</span><br><span class="line">                             self.nextSiblingGenerator, **kwargs)</span><br><span class="line">    fetchNextSiblings = findNextSiblings <span class="comment"># Compatibility with pre-3.x</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findPrevious</span><span class="params">(self, name=None, attrs=&#123;&#125;, text=None, **kwargs)</span>:</span></span><br><span class="line">        <span class="string">"""Returns the first item that matches the given criteria and</span></span><br><span class="line"><span class="string">        appears before this Tag in the document."""</span></span><br><span class="line">        <span class="keyword">return</span> self._findOne(self.findAllPrevious, name, attrs, text, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findAllPrevious</span><span class="params">(self, name=None, attrs=&#123;&#125;, text=None, limit=None,</span></span></span><br><span class="line"><span class="function"><span class="params">                        **kwargs)</span>:</span></span><br><span class="line">        <span class="string">"""Returns all items that match the given criteria and appear</span></span><br><span class="line"><span class="string">        before this Tag in the document."""</span></span><br><span class="line">        <span class="keyword">return</span> self._findAll(name, attrs, text, limit, self.previousGenerator,</span><br><span class="line">                           **kwargs)</span><br><span class="line">    fetchPrevious = findAllPrevious <span class="comment"># Compatibility with pre-3.x</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findPreviousSibling</span><span class="params">(self, name=None, attrs=&#123;&#125;, text=None, **kwargs)</span>:</span></span><br><span class="line">        <span class="string">"""Returns the closest sibling to this Tag that matches the</span></span><br><span class="line"><span class="string">        given criteria and appears before this Tag in the document."""</span></span><br><span class="line">        <span class="keyword">return</span> self._findOne(self.findPreviousSiblings, name, attrs, text,</span><br><span class="line">                             **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findPreviousSiblings</span><span class="params">(self, name=None, attrs=&#123;&#125;, text=None,</span></span></span><br><span class="line"><span class="function"><span class="params">                             limit=None, **kwargs)</span>:</span></span><br><span class="line">        <span class="string">"""Returns the siblings of this Tag that match the given</span></span><br><span class="line"><span class="string">        criteria and appear before this Tag in the document."""</span></span><br><span class="line">        <span class="keyword">return</span> self._findAll(name, attrs, text, limit,</span><br><span class="line">                             self.previousSiblingGenerator, **kwargs)</span><br><span class="line">    fetchPreviousSiblings = findPreviousSiblings <span class="comment"># Compatibility with pre-3.x</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findParent</span><span class="params">(self, name=None, attrs=&#123;&#125;, **kwargs)</span>:</span></span><br><span class="line">        <span class="string">"""Returns the closest parent of this Tag that matches the given</span></span><br><span class="line"><span class="string">        criteria."""</span></span><br><span class="line">        <span class="comment"># <span class="doctag">NOTE:</span> We can't use _findOne because findParents takes a different</span></span><br><span class="line">        <span class="comment"># set of arguments.</span></span><br><span class="line">        r = <span class="keyword">None</span></span><br><span class="line">        l = self.findParents(name, attrs, <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> l:</span><br><span class="line">            r = l[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">return</span> r</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findParents</span><span class="params">(self, name=None, attrs=&#123;&#125;, limit=None, **kwargs)</span>:</span></span><br><span class="line">        <span class="string">"""Returns the parents of this Tag that match the given</span></span><br><span class="line"><span class="string">        criteria."""</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self._findAll(name, attrs, <span class="keyword">None</span>, limit, self.parentGenerator,</span><br><span class="line">                             **kwargs)</span><br><span class="line">    fetchParents = findParents <span class="comment"># Compatibility with pre-3.x</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#These methods do the real heavy lifting.</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_findOne</span><span class="params">(self, method, name, attrs, text, **kwargs)</span>:</span></span><br><span class="line">        r = <span class="keyword">None</span></span><br><span class="line">        l = method(name, attrs, text, <span class="number">1</span>, **kwargs)</span><br><span class="line">        <span class="keyword">if</span> l:</span><br><span class="line">            r = l[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">return</span> r</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_findAll</span><span class="params">(self, name, attrs, text, limit, generator, **kwargs)</span>:</span></span><br><span class="line">        <span class="string">"Iterates over a generator looking for things that match."</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> isinstance(name, SoupStrainer):</span><br><span class="line">            strainer = name</span><br><span class="line">        <span class="comment"># (Possibly) special case some findAll*(...) searches</span></span><br><span class="line">        <span class="keyword">elif</span> text <span class="keyword">is</span> <span class="keyword">None</span> <span class="keyword">and</span> <span class="keyword">not</span> limit <span class="keyword">and</span> <span class="keyword">not</span> attrs <span class="keyword">and</span> <span class="keyword">not</span> kwargs:</span><br><span class="line">            <span class="comment"># findAll*(True)</span></span><br><span class="line">            <span class="keyword">if</span> name <span class="keyword">is</span> <span class="keyword">True</span>:</span><br><span class="line">                <span class="keyword">return</span> [element <span class="keyword">for</span> element <span class="keyword">in</span> generator()</span><br><span class="line">                        <span class="keyword">if</span> isinstance(element, Tag)]</span><br><span class="line">            <span class="comment"># findAll*('tag-name')</span></span><br><span class="line">            <span class="keyword">elif</span> isinstance(name, basestring):</span><br><span class="line">                <span class="keyword">return</span> [element <span class="keyword">for</span> element <span class="keyword">in</span> generator()</span><br><span class="line">                        <span class="keyword">if</span> isinstance(element, Tag) <span class="keyword">and</span></span><br><span class="line">                        element.name == name]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                strainer = SoupStrainer(name, attrs, text, **kwargs)</span><br><span class="line">        <span class="comment"># Build a SoupStrainer</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            strainer = SoupStrainer(name, attrs, text, **kwargs)</span><br><span class="line">        results = ResultSet(strainer)</span><br><span class="line">        g = generator()</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                i = g.next()</span><br><span class="line">            <span class="keyword">except</span> StopIteration:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> i:</span><br><span class="line">                found = strainer.search(i)</span><br><span class="line">                <span class="keyword">if</span> found:</span><br><span class="line">                    results.append(found)</span><br><span class="line">                    <span class="keyword">if</span> limit <span class="keyword">and</span> len(results) &gt;= limit:</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line">    <span class="comment">#These Generators can be used to navigate starting from both</span></span><br><span class="line">    <span class="comment">#NavigableStrings and Tags.</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">nextGenerator</span><span class="params">(self)</span>:</span></span><br><span class="line">        i = self</span><br><span class="line">        <span class="keyword">while</span> i <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">            i = i.next</span><br><span class="line">            <span class="keyword">yield</span> i</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">nextSiblingGenerator</span><span class="params">(self)</span>:</span></span><br><span class="line">        i = self</span><br><span class="line">        <span class="keyword">while</span> i <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">            i = i.nextSibling</span><br><span class="line">            <span class="keyword">yield</span> i</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">previousGenerator</span><span class="params">(self)</span>:</span></span><br><span class="line">        i = self</span><br><span class="line">        <span class="keyword">while</span> i <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">            i = i.previous</span><br><span class="line">            <span class="keyword">yield</span> i</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">previousSiblingGenerator</span><span class="params">(self)</span>:</span></span><br><span class="line">        i = self</span><br><span class="line">        <span class="keyword">while</span> i <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">            i = i.previousSibling</span><br><span class="line">            <span class="keyword">yield</span> i</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parentGenerator</span><span class="params">(self)</span>:</span></span><br><span class="line">        i = self</span><br><span class="line">        <span class="keyword">while</span> i <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">            i = i.parent</span><br><span class="line">            <span class="keyword">yield</span> i</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Utility methods</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">substituteEncoding</span><span class="params">(self, str, encoding=None)</span>:</span></span><br><span class="line">        encoding = encoding <span class="keyword">or</span> <span class="string">"utf-8"</span></span><br><span class="line">        <span class="keyword">return</span> str.replace(<span class="string">"%SOUP-ENCODING%"</span>, encoding)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">toEncoding</span><span class="params">(self, s, encoding=None)</span>:</span></span><br><span class="line">        <span class="string">"""Encodes an object to a string in some encoding, or to Unicode.</span></span><br><span class="line"><span class="string">        ."""</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(s, unicode):</span><br><span class="line">            <span class="keyword">if</span> encoding:</span><br><span class="line">                s = s.encode(encoding)</span><br><span class="line">        <span class="keyword">elif</span> isinstance(s, str):</span><br><span class="line">            <span class="keyword">if</span> encoding:</span><br><span class="line">                s = s.encode(encoding)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                s = unicode(s)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> encoding:</span><br><span class="line">                s  = self.toEncoding(str(s), encoding)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                s = unicode(s)</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line">    BARE_AMPERSAND_OR_BRACKET = re.compile(<span class="string">"([&lt;&gt;]|"</span></span><br><span class="line">                                           + <span class="string">"&amp;(?!#\d+;|#x[0-9a-fA-F]+;|\w+;)"</span></span><br><span class="line">                                           + <span class="string">")"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_sub_entity</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        <span class="string">"""Used with a regular expression to substitute the</span></span><br><span class="line"><span class="string">        appropriate XML entity for an XML special character."""</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"&amp;"</span> + self.XML_SPECIAL_CHARS_TO_ENTITIES[x.group(<span class="number">0</span>)[<span class="number">0</span>]] + <span class="string">";"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NavigableString</span><span class="params">(unicode, PageElement)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls, value)</span>:</span></span><br><span class="line">        <span class="string">"""Create a new NavigableString.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        When unpickling a NavigableString, this method is called with</span></span><br><span class="line"><span class="string">        the string in DEFAULT_OUTPUT_ENCODING. That encoding needs to be</span></span><br><span class="line"><span class="string">        passed in to the superclass's __new__ or the superclass won't know</span></span><br><span class="line"><span class="string">        how to handle non-ASCII characters.</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(value, unicode):</span><br><span class="line">            <span class="keyword">return</span> unicode.__new__(cls, value)</span><br><span class="line">        <span class="keyword">return</span> unicode.__new__(cls, value, DEFAULT_OUTPUT_ENCODING)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getnewargs__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> (NavigableString.__str__(self),)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, attr)</span>:</span></span><br><span class="line">        <span class="string">"""text.string gives you text. This is for backwards</span></span><br><span class="line"><span class="string">        compatibility for Navigable*String, but for CData* it lets you</span></span><br><span class="line"><span class="string">        get the string without the CData wrapper."""</span></span><br><span class="line">        <span class="keyword">if</span> attr == <span class="string">'string'</span>:</span><br><span class="line">            <span class="keyword">return</span> self</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> AttributeError, <span class="string">"'%s' object has no attribute '%s'"</span> % (self.__class__.__name__, attr)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__unicode__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> str(self).decode(DEFAULT_OUTPUT_ENCODING)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self, encoding=DEFAULT_OUTPUT_ENCODING)</span>:</span></span><br><span class="line">        <span class="comment"># Substitute outgoing XML entities.</span></span><br><span class="line">        data = self.BARE_AMPERSAND_OR_BRACKET.sub(self._sub_entity, self)</span><br><span class="line">        <span class="keyword">if</span> encoding:</span><br><span class="line">            <span class="keyword">return</span> data.encode(encoding)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CData</span><span class="params">(NavigableString)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self, encoding=DEFAULT_OUTPUT_ENCODING)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"&lt;![CDATA[%s]]&gt;"</span> % NavigableString.__str__(self, encoding)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProcessingInstruction</span><span class="params">(NavigableString)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self, encoding=DEFAULT_OUTPUT_ENCODING)</span>:</span></span><br><span class="line">        output = self</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"%SOUP-ENCODING%"</span> <span class="keyword">in</span> output:</span><br><span class="line">            output = self.substituteEncoding(output, encoding)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"&lt;?%s?&gt;"</span> % self.toEncoding(output, encoding)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Comment</span><span class="params">(NavigableString)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self, encoding=DEFAULT_OUTPUT_ENCODING)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"&lt;!--%s--&gt;"</span> % NavigableString.__str__(self, encoding)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Declaration</span><span class="params">(NavigableString)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self, encoding=DEFAULT_OUTPUT_ENCODING)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"&lt;!%s&gt;"</span> % NavigableString.__str__(self, encoding)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tag</span><span class="params">(PageElement)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="string">"""Represents a found HTML tag with its attributes and contents."""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_convertEntities</span><span class="params">(self, match)</span>:</span></span><br><span class="line">        <span class="string">"""Used in a call to re.sub to replace HTML, XML, and numeric</span></span><br><span class="line"><span class="string">        entities with the appropriate Unicode characters. If HTML</span></span><br><span class="line"><span class="string">        entities are being converted, any unrecognized entities are</span></span><br><span class="line"><span class="string">        escaped."""</span></span><br><span class="line">        x = match.group(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> self.convertHTMLEntities <span class="keyword">and</span> x <span class="keyword">in</span> name2codepoint:</span><br><span class="line">            <span class="keyword">return</span> unichr(name2codepoint[x])</span><br><span class="line">        <span class="keyword">elif</span> x <span class="keyword">in</span> self.XML_ENTITIES_TO_SPECIAL_CHARS:</span><br><span class="line">            <span class="keyword">if</span> self.convertXMLEntities:</span><br><span class="line">                <span class="keyword">return</span> self.XML_ENTITIES_TO_SPECIAL_CHARS[x]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">u'&amp;%s;'</span> % x</span><br><span class="line">        <span class="keyword">elif</span> len(x) &gt; <span class="number">0</span> <span class="keyword">and</span> x[<span class="number">0</span>] == <span class="string">'#'</span>:</span><br><span class="line">            <span class="comment"># Handle numeric entities</span></span><br><span class="line">            <span class="keyword">if</span> len(x) &gt; <span class="number">1</span> <span class="keyword">and</span> x[<span class="number">1</span>] == <span class="string">'x'</span>:</span><br><span class="line">                <span class="keyword">return</span> unichr(int(x[<span class="number">2</span>:], <span class="number">16</span>))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> unichr(int(x[<span class="number">1</span>:]))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> self.escapeUnrecognizedEntities:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">u'&amp;amp;%s;'</span> % x</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">u'&amp;%s;'</span> % x</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, parser, name, attrs=None, parent=None,</span></span></span><br><span class="line"><span class="function"><span class="params">                 previous=None)</span>:</span></span><br><span class="line">        <span class="string">"Basic constructor."</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># We don't actually store the parser object: that lets extracted</span></span><br><span class="line">        <span class="comment"># chunks be garbage-collected</span></span><br><span class="line">        self.parserClass = parser.__class__</span><br><span class="line">        self.isSelfClosing = parser.isSelfClosingTag(name)</span><br><span class="line">        self.name = name</span><br><span class="line">        <span class="keyword">if</span> attrs <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            attrs = []</span><br><span class="line">        <span class="keyword">elif</span> isinstance(attrs, dict):</span><br><span class="line">            attrs = attrs.items()</span><br><span class="line">        self.attrs = attrs</span><br><span class="line">        self.contents = []</span><br><span class="line">        self.setup(parent, previous)</span><br><span class="line">        self.hidden = <span class="keyword">False</span></span><br><span class="line">        self.containsSubstitutions = <span class="keyword">False</span></span><br><span class="line">        self.convertHTMLEntities = parser.convertHTMLEntities</span><br><span class="line">        self.convertXMLEntities = parser.convertXMLEntities</span><br><span class="line">        self.escapeUnrecognizedEntities = parser.escapeUnrecognizedEntities</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Convert any HTML, XML, or numeric entities in the attribute values.</span></span><br><span class="line">        convert = <span class="keyword">lambda</span>(k, val): (k,</span><br><span class="line">                                   re.sub(<span class="string">"&amp;(#\d+|#x[0-9a-fA-F]+|\w+);"</span>,</span><br><span class="line">                                          self._convertEntities,</span><br><span class="line">                                          val))</span><br><span class="line">        self.attrs = map(convert, self.attrs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getString</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> (len(self.contents) == <span class="number">1</span></span><br><span class="line">            <span class="keyword">and</span> isinstance(self.contents[<span class="number">0</span>], NavigableString)):</span><br><span class="line">            <span class="keyword">return</span> self.contents[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setString</span><span class="params">(self, string)</span>:</span></span><br><span class="line">        <span class="string">"""Replace the contents of the tag with a string"""</span></span><br><span class="line">        self.clear()</span><br><span class="line">        self.append(string)</span><br><span class="line"></span><br><span class="line">    string = property(getString, setString)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getText</span><span class="params">(self, separator=<span class="string">u""</span>)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> len(self.contents):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">u""</span></span><br><span class="line">        stopNode = self._lastRecursiveChild().next</span><br><span class="line">        strings = []</span><br><span class="line">        current = self.contents[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">while</span> current <span class="keyword">is</span> <span class="keyword">not</span> stopNode:</span><br><span class="line">            <span class="keyword">if</span> isinstance(current, NavigableString):</span><br><span class="line">                strings.append(current.strip())</span><br><span class="line">            current = current.next</span><br><span class="line">        <span class="keyword">return</span> separator.join(strings)</span><br><span class="line"></span><br><span class="line">    text = property(getText)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, key, default=None)</span>:</span></span><br><span class="line">        <span class="string">"""Returns the value of the 'key' attribute for the tag, or</span></span><br><span class="line"><span class="string">        the value given for 'default' if it doesn't have that</span></span><br><span class="line"><span class="string">        attribute."""</span></span><br><span class="line">        <span class="keyword">return</span> self._getAttrMap().get(key, default)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clear</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""Extract all children."""</span></span><br><span class="line">        <span class="keyword">for</span> child <span class="keyword">in</span> self.contents[:]:</span><br><span class="line">            child.extract()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(self, element)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> i, child <span class="keyword">in</span> enumerate(self.contents):</span><br><span class="line">            <span class="keyword">if</span> child <span class="keyword">is</span> element:</span><br><span class="line">                <span class="keyword">return</span> i</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">"Tag.index: element not in tag"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">has_key</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._getAttrMap().has_key(key)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        <span class="string">"""tag[key] returns the value of the 'key' attribute for the tag,</span></span><br><span class="line"><span class="string">        and throws an exception if it's not there."""</span></span><br><span class="line">        <span class="keyword">return</span> self._getAttrMap()[key]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"Iterating over a tag iterates over its contents."</span></span><br><span class="line">        <span class="keyword">return</span> iter(self.contents)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"The length of a tag is the length of its list of contents."</span></span><br><span class="line">        <span class="keyword">return</span> len(self.contents)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__contains__</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> x <span class="keyword">in</span> self.contents</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__nonzero__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"A tag is non-None even if it has no contents."</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setitem__</span><span class="params">(self, key, value)</span>:</span></span><br><span class="line">        <span class="string">"""Setting tag[key] sets the value of the 'key' attribute for the</span></span><br><span class="line"><span class="string">        tag."""</span></span><br><span class="line">        self._getAttrMap()</span><br><span class="line">        self.attrMap[key] = value</span><br><span class="line">        found = <span class="keyword">False</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(self.attrs)):</span><br><span class="line">            <span class="keyword">if</span> self.attrs[i][<span class="number">0</span>] == key:</span><br><span class="line">                self.attrs[i] = (key, value)</span><br><span class="line">                found = <span class="keyword">True</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> found:</span><br><span class="line">            self.attrs.append((key, value))</span><br><span class="line">        self._getAttrMap()[key] = value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delitem__</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        <span class="string">"Deleting tag[key] deletes all 'key' attributes for the tag."</span></span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> self.attrs:</span><br><span class="line">            <span class="keyword">if</span> item[<span class="number">0</span>] == key:</span><br><span class="line">                self.attrs.remove(item)</span><br><span class="line">                <span class="comment">#We don't break because bad HTML can define the same</span></span><br><span class="line">                <span class="comment">#attribute multiple times.</span></span><br><span class="line">            self._getAttrMap()</span><br><span class="line">            <span class="keyword">if</span> self.attrMap.has_key(key):</span><br><span class="line">                <span class="keyword">del</span> self.attrMap[key]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="string">"""Calling a tag like a function is the same as calling its</span></span><br><span class="line"><span class="string">        findAll() method. Eg. tag('a') returns a list of all the A tags</span></span><br><span class="line"><span class="string">        found within this tag."""</span></span><br><span class="line">        <span class="keyword">return</span> apply(self.findAll, args, kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, tag)</span>:</span></span><br><span class="line">        <span class="comment">#print "Getattr %s.%s" % (self.__class__, tag)</span></span><br><span class="line">        <span class="keyword">if</span> len(tag) &gt; <span class="number">3</span> <span class="keyword">and</span> tag.rfind(<span class="string">'Tag'</span>) == len(tag)<span class="number">-3</span>:</span><br><span class="line">            <span class="keyword">return</span> self.find(tag[:<span class="number">-3</span>])</span><br><span class="line">        <span class="keyword">elif</span> tag.find(<span class="string">'__'</span>) != <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> self.find(tag)</span><br><span class="line">        <span class="keyword">raise</span> AttributeError, <span class="string">"'%s' object has no attribute '%s'"</span> % (self.__class__, tag)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">        <span class="string">"""Returns true iff this tag has the same name, the same attributes,</span></span><br><span class="line"><span class="string">        and the same contents (recursively) as the given tag.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        NOTE: right now this will return false if two tags have the</span></span><br><span class="line"><span class="string">        same attributes in a different order. Should this be fixed?"""</span></span><br><span class="line">        <span class="keyword">if</span> other <span class="keyword">is</span> self:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> hasattr(other, <span class="string">'name'</span>) <span class="keyword">or</span> <span class="keyword">not</span> hasattr(other, <span class="string">'attrs'</span>) <span class="keyword">or</span> <span class="keyword">not</span> hasattr(other, <span class="string">'contents'</span>) <span class="keyword">or</span> self.name != other.name <span class="keyword">or</span> self.attrs != other.attrs <span class="keyword">or</span> len(self) != len(other):</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(self.contents)):</span><br><span class="line">            <span class="keyword">if</span> self.contents[i] != other.contents[i]:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__ne__</span><span class="params">(self, other)</span>:</span></span><br><span class="line">        <span class="string">"""Returns true iff this tag is not identical to the other tag,</span></span><br><span class="line"><span class="string">        as defined in __eq__."""</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">not</span> self == other</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self, encoding=DEFAULT_OUTPUT_ENCODING)</span>:</span></span><br><span class="line">        <span class="string">"""Renders this tag as a string."""</span></span><br><span class="line">        <span class="keyword">return</span> self.__str__(encoding)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__unicode__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__str__(<span class="keyword">None</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self, encoding=DEFAULT_OUTPUT_ENCODING,</span></span></span><br><span class="line"><span class="function"><span class="params">                prettyPrint=False, indentLevel=<span class="number">0</span>)</span>:</span></span><br><span class="line">        <span class="string">"""Returns a string or Unicode representation of this tag and</span></span><br><span class="line"><span class="string">        its contents. To get Unicode, pass None for encoding.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        NOTE: since Python's HTML parser consumes whitespace, this</span></span><br><span class="line"><span class="string">        method is not certain to reproduce the whitespace present in</span></span><br><span class="line"><span class="string">        the original string."""</span></span><br><span class="line"></span><br><span class="line">        encodedName = self.toEncoding(self.name, encoding)</span><br><span class="line"></span><br><span class="line">        attrs = []</span><br><span class="line">        <span class="keyword">if</span> self.attrs:</span><br><span class="line">            <span class="keyword">for</span> key, val <span class="keyword">in</span> self.attrs:</span><br><span class="line">                fmt = <span class="string">'%s="%s"'</span></span><br><span class="line">                <span class="keyword">if</span> isinstance(val, basestring):</span><br><span class="line">                    <span class="keyword">if</span> self.containsSubstitutions <span class="keyword">and</span> <span class="string">'%SOUP-ENCODING%'</span> <span class="keyword">in</span> val:</span><br><span class="line">                        val = self.substituteEncoding(val, encoding)</span><br><span class="line"></span><br><span class="line">                    <span class="comment"># The attribute value either:</span></span><br><span class="line">                    <span class="comment">#</span></span><br><span class="line">                    <span class="comment"># * Contains no embedded double quotes or single quotes.</span></span><br><span class="line">                    <span class="comment">#   No problem: we enclose it in double quotes.</span></span><br><span class="line">                    <span class="comment"># * Contains embedded single quotes. No problem:</span></span><br><span class="line">                    <span class="comment">#   double quotes work here too.</span></span><br><span class="line">                    <span class="comment"># * Contains embedded double quotes. No problem:</span></span><br><span class="line">                    <span class="comment">#   we enclose it in single quotes.</span></span><br><span class="line">                    <span class="comment"># * Embeds both single _and_ double quotes. This</span></span><br><span class="line">                    <span class="comment">#   can't happen naturally, but it can happen if</span></span><br><span class="line">                    <span class="comment">#   you modify an attribute value after parsing</span></span><br><span class="line">                    <span class="comment">#   the document. Now we have a bit of a</span></span><br><span class="line">                    <span class="comment">#   problem. We solve it by enclosing the</span></span><br><span class="line">                    <span class="comment">#   attribute in single quotes, and escaping any</span></span><br><span class="line">                    <span class="comment">#   embedded single quotes to XML entities.</span></span><br><span class="line">                    <span class="keyword">if</span> <span class="string">'"'</span> <span class="keyword">in</span> val:</span><br><span class="line">                        fmt = <span class="string">"%s='%s'"</span></span><br><span class="line">                        <span class="keyword">if</span> <span class="string">"'"</span> <span class="keyword">in</span> val:</span><br><span class="line">                            <span class="comment"># <span class="doctag">TODO:</span> replace with apos when</span></span><br><span class="line">                            <span class="comment"># appropriate.</span></span><br><span class="line">                            val = val.replace(<span class="string">"'"</span>, <span class="string">"&amp;squot;"</span>)</span><br><span class="line"></span><br><span class="line">                    <span class="comment"># Now we're okay w/r/t quotes. But the attribute</span></span><br><span class="line">                    <span class="comment"># value might also contain angle brackets, or</span></span><br><span class="line">                    <span class="comment"># ampersands that aren't part of entities. We need</span></span><br><span class="line">                    <span class="comment"># to escape those to XML entities too.</span></span><br><span class="line">                    val = self.BARE_AMPERSAND_OR_BRACKET.sub(self._sub_entity, val)</span><br><span class="line"></span><br><span class="line">                attrs.append(fmt % (self.toEncoding(key, encoding),</span><br><span class="line">                                    self.toEncoding(val, encoding)))</span><br><span class="line">        close = <span class="string">''</span></span><br><span class="line">        closeTag = <span class="string">''</span></span><br><span class="line">        <span class="keyword">if</span> self.isSelfClosing:</span><br><span class="line">            close = <span class="string">' /'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            closeTag = <span class="string">'&lt;/%s&gt;'</span> % encodedName</span><br><span class="line"></span><br><span class="line">        indentTag, indentContents = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> prettyPrint:</span><br><span class="line">            indentTag = indentLevel</span><br><span class="line">            space = (<span class="string">' '</span> * (indentTag<span class="number">-1</span>))</span><br><span class="line">            indentContents = indentTag + <span class="number">1</span></span><br><span class="line">        contents = self.renderContents(encoding, prettyPrint, indentContents)</span><br><span class="line">        <span class="keyword">if</span> self.hidden:</span><br><span class="line">            s = contents</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            s = []</span><br><span class="line">            attributeString = <span class="string">''</span></span><br><span class="line">            <span class="keyword">if</span> attrs:</span><br><span class="line">                attributeString = <span class="string">' '</span> + <span class="string">' '</span>.join(attrs)</span><br><span class="line">            <span class="keyword">if</span> prettyPrint:</span><br><span class="line">                s.append(space)</span><br><span class="line">            s.append(<span class="string">'&lt;%s%s%s&gt;'</span> % (encodedName, attributeString, close))</span><br><span class="line">            <span class="keyword">if</span> prettyPrint:</span><br><span class="line">                s.append(<span class="string">"\n"</span>)</span><br><span class="line">            s.append(contents)</span><br><span class="line">            <span class="keyword">if</span> prettyPrint <span class="keyword">and</span> contents <span class="keyword">and</span> contents[<span class="number">-1</span>] != <span class="string">"\n"</span>:</span><br><span class="line">                s.append(<span class="string">"\n"</span>)</span><br><span class="line">            <span class="keyword">if</span> prettyPrint <span class="keyword">and</span> closeTag:</span><br><span class="line">                s.append(space)</span><br><span class="line">            s.append(closeTag)</span><br><span class="line">            <span class="keyword">if</span> prettyPrint <span class="keyword">and</span> closeTag <span class="keyword">and</span> self.nextSibling:</span><br><span class="line">                s.append(<span class="string">"\n"</span>)</span><br><span class="line">            s = <span class="string">''</span>.join(s)</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decompose</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""Recursively destroys the contents of this tree."""</span></span><br><span class="line">        self.extract()</span><br><span class="line">        <span class="keyword">if</span> len(self.contents) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        current = self.contents[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">while</span> current <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">            next = current.next</span><br><span class="line">            <span class="keyword">if</span> isinstance(current, Tag):</span><br><span class="line">                <span class="keyword">del</span> current.contents[:]</span><br><span class="line">            current.parent = <span class="keyword">None</span></span><br><span class="line">            current.previous = <span class="keyword">None</span></span><br><span class="line">            current.previousSibling = <span class="keyword">None</span></span><br><span class="line">            current.next = <span class="keyword">None</span></span><br><span class="line">            current.nextSibling = <span class="keyword">None</span></span><br><span class="line">            current = next</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">prettify</span><span class="params">(self, encoding=DEFAULT_OUTPUT_ENCODING)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__str__(encoding, <span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">renderContents</span><span class="params">(self, encoding=DEFAULT_OUTPUT_ENCODING,</span></span></span><br><span class="line"><span class="function"><span class="params">                       prettyPrint=False, indentLevel=<span class="number">0</span>)</span>:</span></span><br><span class="line">        <span class="string">"""Renders the contents of this tag as a string in the given</span></span><br><span class="line"><span class="string">        encoding. If encoding is None, returns a Unicode string.."""</span></span><br><span class="line">        s=[]</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> self:</span><br><span class="line">            text = <span class="keyword">None</span></span><br><span class="line">            <span class="keyword">if</span> isinstance(c, NavigableString):</span><br><span class="line">                text = c.__str__(encoding)</span><br><span class="line">            <span class="keyword">elif</span> isinstance(c, Tag):</span><br><span class="line">                s.append(c.__str__(encoding, prettyPrint, indentLevel))</span><br><span class="line">            <span class="keyword">if</span> text <span class="keyword">and</span> prettyPrint:</span><br><span class="line">                text = text.strip()</span><br><span class="line">            <span class="keyword">if</span> text:</span><br><span class="line">                <span class="keyword">if</span> prettyPrint:</span><br><span class="line">                    s.append(<span class="string">" "</span> * (indentLevel<span class="number">-1</span>))</span><br><span class="line">                s.append(text)</span><br><span class="line">                <span class="keyword">if</span> prettyPrint:</span><br><span class="line">                    s.append(<span class="string">"\n"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>.join(s)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#Soup methods</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find</span><span class="params">(self, name=None, attrs=&#123;&#125;, recursive=True, text=None,</span></span></span><br><span class="line"><span class="function"><span class="params">             **kwargs)</span>:</span></span><br><span class="line">        <span class="string">"""Return only the first child of this Tag matching the given</span></span><br><span class="line"><span class="string">        criteria."""</span></span><br><span class="line">        r = <span class="keyword">None</span></span><br><span class="line">        l = self.findAll(name, attrs, recursive, text, <span class="number">1</span>, **kwargs)</span><br><span class="line">        <span class="keyword">if</span> l:</span><br><span class="line">            r = l[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">return</span> r</span><br><span class="line">    findChild = find</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findAll</span><span class="params">(self, name=None, attrs=&#123;&#125;, recursive=True, text=None,</span></span></span><br><span class="line"><span class="function"><span class="params">                limit=None, **kwargs)</span>:</span></span><br><span class="line">        <span class="string">"""Extracts a list of Tag objects that match the given</span></span><br><span class="line"><span class="string">        criteria.  You can specify the name of the Tag and any</span></span><br><span class="line"><span class="string">        attributes you want the Tag to have.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        The value of a key-value pair in the 'attrs' map can be a</span></span><br><span class="line"><span class="string">        string, a list of strings, a regular expression object, or a</span></span><br><span class="line"><span class="string">        callable that takes a string and returns whether or not the</span></span><br><span class="line"><span class="string">        string matches for some custom definition of 'matches'. The</span></span><br><span class="line"><span class="string">        same is true of the tag name."""</span></span><br><span class="line">        generator = self.recursiveChildGenerator</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> recursive:</span><br><span class="line">            generator = self.childGenerator</span><br><span class="line">        <span class="keyword">return</span> self._findAll(name, attrs, text, limit, generator, **kwargs)</span><br><span class="line">    findChildren = findAll</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Pre-3.x compatibility methods</span></span><br><span class="line">    first = find</span><br><span class="line">    fetch = findAll</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fetchText</span><span class="params">(self, text=None, recursive=True, limit=None)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.findAll(text=text, recursive=recursive, limit=limit)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">firstText</span><span class="params">(self, text=None, recursive=True)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.find(text=text, recursive=recursive)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#Private methods</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_getAttrMap</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""Initializes a map representation of this tag's attributes,</span></span><br><span class="line"><span class="string">        if not already initialized."""</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> getattr(self, <span class="string">'attrMap'</span>):</span><br><span class="line">            self.attrMap = &#123;&#125;</span><br><span class="line">            <span class="keyword">for</span> (key, value) <span class="keyword">in</span> self.attrs:</span><br><span class="line">                self.attrMap[key] = value</span><br><span class="line">        <span class="keyword">return</span> self.attrMap</span><br><span class="line"></span><br><span class="line">    <span class="comment">#Generator methods</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">childGenerator</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># Just use the iterator from the contents</span></span><br><span class="line">        <span class="keyword">return</span> iter(self.contents)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">recursiveChildGenerator</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> len(self.contents):</span><br><span class="line">            <span class="keyword">raise</span> StopIteration</span><br><span class="line">        stopNode = self._lastRecursiveChild().next</span><br><span class="line">        current = self.contents[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">while</span> current <span class="keyword">is</span> <span class="keyword">not</span> stopNode:</span><br><span class="line">            <span class="keyword">yield</span> current</span><br><span class="line">            current = current.next</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Next, a couple classes to represent queries and their results.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SoupStrainer</span>:</span></span><br><span class="line">    <span class="string">"""Encapsulates a number of ways of matching a markup element (tag or</span></span><br><span class="line"><span class="string">    text)."""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name=None, attrs=&#123;&#125;, text=None, **kwargs)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        <span class="keyword">if</span> isinstance(attrs, basestring):</span><br><span class="line">            kwargs[<span class="string">'class'</span>] = _match_css_class(attrs)</span><br><span class="line">            attrs = <span class="keyword">None</span></span><br><span class="line">        <span class="keyword">if</span> kwargs:</span><br><span class="line">            <span class="keyword">if</span> attrs:</span><br><span class="line">                attrs = attrs.copy()</span><br><span class="line">                attrs.update(kwargs)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                attrs = kwargs</span><br><span class="line">        self.attrs = attrs</span><br><span class="line">        self.text = text</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.text:</span><br><span class="line">            <span class="keyword">return</span> self.text</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"%s|%s"</span> % (self.name, self.attrs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">searchTag</span><span class="params">(self, markupName=None, markupAttrs=&#123;&#125;)</span>:</span></span><br><span class="line">        found = <span class="keyword">None</span></span><br><span class="line">        markup = <span class="keyword">None</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(markupName, Tag):</span><br><span class="line">            markup = markupName</span><br><span class="line">            markupAttrs = markup</span><br><span class="line">        callFunctionWithTagData = callable(self.name) \</span><br><span class="line">                                <span class="keyword">and</span> <span class="keyword">not</span> isinstance(markupName, Tag)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">not</span> self.name) \</span><br><span class="line">               <span class="keyword">or</span> callFunctionWithTagData \</span><br><span class="line">               <span class="keyword">or</span> (markup <span class="keyword">and</span> self._matches(markup, self.name)) \</span><br><span class="line">               <span class="keyword">or</span> (<span class="keyword">not</span> markup <span class="keyword">and</span> self._matches(markupName, self.name)):</span><br><span class="line">            <span class="keyword">if</span> callFunctionWithTagData:</span><br><span class="line">                match = self.name(markupName, markupAttrs)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                match = <span class="keyword">True</span></span><br><span class="line">                markupAttrMap = <span class="keyword">None</span></span><br><span class="line">                <span class="keyword">for</span> attr, matchAgainst <span class="keyword">in</span> self.attrs.items():</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">not</span> markupAttrMap:</span><br><span class="line">                         <span class="keyword">if</span> hasattr(markupAttrs, <span class="string">'get'</span>):</span><br><span class="line">                            markupAttrMap = markupAttrs</span><br><span class="line">                         <span class="keyword">else</span>:</span><br><span class="line">                            markupAttrMap = &#123;&#125;</span><br><span class="line">                            <span class="keyword">for</span> k,v <span class="keyword">in</span> markupAttrs:</span><br><span class="line">                                markupAttrMap[k] = v</span><br><span class="line">                    attrValue = markupAttrMap.get(attr)</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">not</span> self._matches(attrValue, matchAgainst):</span><br><span class="line">                        match = <span class="keyword">False</span></span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> match:</span><br><span class="line">                <span class="keyword">if</span> markup:</span><br><span class="line">                    found = markup</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    found = markupName</span><br><span class="line">        <span class="keyword">return</span> found</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">search</span><span class="params">(self, markup)</span>:</span></span><br><span class="line">        <span class="comment">#print 'looking for %s in %s' % (self, markup)</span></span><br><span class="line">        found = <span class="keyword">None</span></span><br><span class="line">        <span class="comment"># If given a list of items, scan it for a text element that</span></span><br><span class="line">        <span class="comment"># matches.</span></span><br><span class="line">        <span class="keyword">if</span> hasattr(markup, <span class="string">"__iter__"</span>) \</span><br><span class="line">                <span class="keyword">and</span> <span class="keyword">not</span> isinstance(markup, Tag):</span><br><span class="line">            <span class="keyword">for</span> element <span class="keyword">in</span> markup:</span><br><span class="line">                <span class="keyword">if</span> isinstance(element, NavigableString) \</span><br><span class="line">                       <span class="keyword">and</span> self.search(element):</span><br><span class="line">                    found = element</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">        <span class="comment"># If it's a Tag, make sure its name or attributes match.</span></span><br><span class="line">        <span class="comment"># Don't bother with Tags if we're searching for text.</span></span><br><span class="line">        <span class="keyword">elif</span> isinstance(markup, Tag):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.text:</span><br><span class="line">                found = self.searchTag(markup)</span><br><span class="line">        <span class="comment"># If it's text, make sure the text matches.</span></span><br><span class="line">        <span class="keyword">elif</span> isinstance(markup, NavigableString) <span class="keyword">or</span> \</span><br><span class="line">                 isinstance(markup, basestring):</span><br><span class="line">            <span class="keyword">if</span> self._matches(markup, self.text):</span><br><span class="line">                found = markup</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> Exception, <span class="string">"I don't know how to match against a %s"</span> \</span><br><span class="line">                  % markup.__class__</span><br><span class="line">        <span class="keyword">return</span> found</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_matches</span><span class="params">(self, markup, matchAgainst)</span>:</span></span><br><span class="line">        <span class="comment">#print "Matching %s against %s" % (markup, matchAgainst)</span></span><br><span class="line">        result = <span class="keyword">False</span></span><br><span class="line">        <span class="keyword">if</span> matchAgainst <span class="keyword">is</span> <span class="keyword">True</span>:</span><br><span class="line">            result = markup <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span></span><br><span class="line">        <span class="keyword">elif</span> callable(matchAgainst):</span><br><span class="line">            result = matchAgainst(markup)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment">#Custom match methods take the tag as an argument, but all</span></span><br><span class="line">            <span class="comment">#other ways of matching match the tag name as a string.</span></span><br><span class="line">            <span class="keyword">if</span> isinstance(markup, Tag):</span><br><span class="line">                markup = markup.name</span><br><span class="line">            <span class="keyword">if</span> markup <span class="keyword">and</span> <span class="keyword">not</span> isinstance(markup, basestring):</span><br><span class="line">                markup = unicode(markup)</span><br><span class="line">            <span class="comment">#Now we know that chunk is either a string, or None.</span></span><br><span class="line">            <span class="keyword">if</span> hasattr(matchAgainst, <span class="string">'match'</span>):</span><br><span class="line">                <span class="comment"># It's a regexp object.</span></span><br><span class="line">                result = markup <span class="keyword">and</span> matchAgainst.search(markup)</span><br><span class="line">            <span class="keyword">elif</span> hasattr(matchAgainst, <span class="string">'__iter__'</span>): <span class="comment"># list-like</span></span><br><span class="line">                result = markup <span class="keyword">in</span> matchAgainst</span><br><span class="line">            <span class="keyword">elif</span> hasattr(matchAgainst, <span class="string">'items'</span>):</span><br><span class="line">                result = markup.has_key(matchAgainst)</span><br><span class="line">            <span class="keyword">elif</span> matchAgainst <span class="keyword">and</span> isinstance(markup, basestring):</span><br><span class="line">                <span class="keyword">if</span> isinstance(markup, unicode):</span><br><span class="line">                    matchAgainst = unicode(matchAgainst)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    matchAgainst = str(matchAgainst)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> result:</span><br><span class="line">                result = matchAgainst == markup</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResultSet</span><span class="params">(list)</span>:</span></span><br><span class="line">    <span class="string">"""A ResultSet is just a list that keeps track of the SoupStrainer</span></span><br><span class="line"><span class="string">    that created it."""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, source)</span>:</span></span><br><span class="line">        list.__init__([])</span><br><span class="line">        self.source = source</span><br><span class="line"></span><br><span class="line"><span class="comment"># Now, some helper functions.</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">buildTagMap</span><span class="params">(default, *args)</span>:</span></span><br><span class="line">    <span class="string">"""Turns a list of maps, lists, or scalars into a single map.</span></span><br><span class="line"><span class="string">    Used to build the SELF_CLOSING_TAGS, NESTABLE_TAGS, and</span></span><br><span class="line"><span class="string">    NESTING_RESET_TAGS maps out of lists and partial maps."""</span></span><br><span class="line">    built = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> portion <span class="keyword">in</span> args:</span><br><span class="line">        <span class="keyword">if</span> hasattr(portion, <span class="string">'items'</span>):</span><br><span class="line">            <span class="comment">#It's a map. Merge it.</span></span><br><span class="line">            <span class="keyword">for</span> k,v <span class="keyword">in</span> portion.items():</span><br><span class="line">                built[k] = v</span><br><span class="line">        <span class="keyword">elif</span> hasattr(portion, <span class="string">'__iter__'</span>): <span class="comment"># is a list</span></span><br><span class="line">            <span class="comment">#It's a list. Map each item to the default.</span></span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> portion:</span><br><span class="line">                built[k] = default</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment">#It's a scalar. Map it to the default.</span></span><br><span class="line">            built[portion] = default</span><br><span class="line">    <span class="keyword">return</span> built</span><br><span class="line"></span><br><span class="line"><span class="comment"># Now, the parser classes.</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BeautifulStoneSoup</span><span class="params">(Tag, SGMLParser)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="string">"""This class contains the basic parser and search code. It defines</span></span><br><span class="line"><span class="string">    a parser that knows nothing about tag behavior except for the</span></span><br><span class="line"><span class="string">    following:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">      You can't close a tag without closing all the tags it encloses.</span></span><br><span class="line"><span class="string">      That is, "&lt;foo&gt;&lt;bar&gt;&lt;/foo&gt;" actually means</span></span><br><span class="line"><span class="string">      "&lt;foo&gt;&lt;bar&gt;&lt;/bar&gt;&lt;/foo&gt;".</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    [Another possible explanation is "&lt;foo&gt;&lt;bar /&gt;&lt;/foo&gt;", but since</span></span><br><span class="line"><span class="string">    this class defines no SELF_CLOSING_TAGS, it will never use that</span></span><br><span class="line"><span class="string">    explanation.]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    This class is useful for parsing XML or made-up markup languages,</span></span><br><span class="line"><span class="string">    or when BeautifulSoup makes an assumption counter to what you were</span></span><br><span class="line"><span class="string">    expecting."""</span></span><br><span class="line"></span><br><span class="line">    SELF_CLOSING_TAGS = &#123;&#125;</span><br><span class="line">    NESTABLE_TAGS = &#123;&#125;</span><br><span class="line">    RESET_NESTING_TAGS = &#123;&#125;</span><br><span class="line">    QUOTE_TAGS = &#123;&#125;</span><br><span class="line">    PRESERVE_WHITESPACE_TAGS = []</span><br><span class="line"></span><br><span class="line">    MARKUP_MASSAGE = [(re.compile(<span class="string">'(&lt;[^&lt;&gt;]*)/&gt;'</span>),</span><br><span class="line">                       <span class="keyword">lambda</span> x: x.group(<span class="number">1</span>) + <span class="string">' /&gt;'</span>),</span><br><span class="line">                      (re.compile(<span class="string">'&lt;!\s+([^&lt;&gt;]*)&gt;'</span>),</span><br><span class="line">                       <span class="keyword">lambda</span> x: <span class="string">'&lt;!'</span> + x.group(<span class="number">1</span>) + <span class="string">'&gt;'</span>)</span><br><span class="line">                      ]</span><br><span class="line"></span><br><span class="line">    ROOT_TAG_NAME = <span class="string">u'[document]'</span></span><br><span class="line"></span><br><span class="line">    HTML_ENTITIES = <span class="string">"html"</span></span><br><span class="line">    XML_ENTITIES = <span class="string">"xml"</span></span><br><span class="line">    XHTML_ENTITIES = <span class="string">"xhtml"</span></span><br><span class="line">    <span class="comment"># <span class="doctag">TODO:</span> This only exists for backwards-compatibility</span></span><br><span class="line">    ALL_ENTITIES = XHTML_ENTITIES</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Used when determining whether a text node is all whitespace and</span></span><br><span class="line">    <span class="comment"># can be replaced with a single space. A text node that contains</span></span><br><span class="line">    <span class="comment"># fancy Unicode spaces (usually non-breaking) should be left</span></span><br><span class="line">    <span class="comment"># alone.</span></span><br><span class="line">    STRIP_ASCII_SPACES = &#123; <span class="number">9</span>: <span class="keyword">None</span>, <span class="number">10</span>: <span class="keyword">None</span>, <span class="number">12</span>: <span class="keyword">None</span>, <span class="number">13</span>: <span class="keyword">None</span>, <span class="number">32</span>: <span class="keyword">None</span>, &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, markup=<span class="string">""</span>, parseOnlyThese=None, fromEncoding=None,</span></span></span><br><span class="line"><span class="function"><span class="params">                 markupMassage=True, smartQuotesTo=XML_ENTITIES,</span></span></span><br><span class="line"><span class="function"><span class="params">                 convertEntities=None, selfClosingTags=None, isHTML=False)</span>:</span></span><br><span class="line">        <span class="string">"""The Soup object is initialized as the 'root tag', and the</span></span><br><span class="line"><span class="string">        provided markup (which can be a string or a file-like object)</span></span><br><span class="line"><span class="string">        is fed into the underlying parser.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        sgmllib will process most bad HTML, and the BeautifulSoup</span></span><br><span class="line"><span class="string">        class has some tricks for dealing with some HTML that kills</span></span><br><span class="line"><span class="string">        sgmllib, but Beautiful Soup can nonetheless choke or lose data</span></span><br><span class="line"><span class="string">        if your data uses self-closing tags or declarations</span></span><br><span class="line"><span class="string">        incorrectly.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        By default, Beautiful Soup uses regexes to sanitize input,</span></span><br><span class="line"><span class="string">        avoiding the vast majority of these problems. If the problems</span></span><br><span class="line"><span class="string">        don't apply to you, pass in False for markupMassage, and</span></span><br><span class="line"><span class="string">        you'll get better performance.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        The default parser massage techniques fix the two most common</span></span><br><span class="line"><span class="string">        instances of invalid HTML that choke sgmllib:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">         &lt;br/&gt; (No space between name of closing tag and tag close)</span></span><br><span class="line"><span class="string">         &lt;! --Comment--&gt; (Extraneous whitespace in declaration)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        You can pass in a custom list of (RE object, replace method)</span></span><br><span class="line"><span class="string">        tuples to get Beautiful Soup to scrub your input the way you</span></span><br><span class="line"><span class="string">        want."""</span></span><br><span class="line"></span><br><span class="line">        self.parseOnlyThese = parseOnlyThese</span><br><span class="line">        self.fromEncoding = fromEncoding</span><br><span class="line">        self.smartQuotesTo = smartQuotesTo</span><br><span class="line">        self.convertEntities = convertEntities</span><br><span class="line">        <span class="comment"># Set the rules for how we'll deal with the entities we</span></span><br><span class="line">        <span class="comment"># encounter</span></span><br><span class="line">        <span class="keyword">if</span> self.convertEntities:</span><br><span class="line">            <span class="comment"># It doesn't make sense to convert encoded characters to</span></span><br><span class="line">            <span class="comment"># entities even while you're converting entities to Unicode.</span></span><br><span class="line">            <span class="comment"># Just convert it all to Unicode.</span></span><br><span class="line">            self.smartQuotesTo = <span class="keyword">None</span></span><br><span class="line">            <span class="keyword">if</span> convertEntities == self.HTML_ENTITIES:</span><br><span class="line">                self.convertXMLEntities = <span class="keyword">False</span></span><br><span class="line">                self.convertHTMLEntities = <span class="keyword">True</span></span><br><span class="line">                self.escapeUnrecognizedEntities = <span class="keyword">True</span></span><br><span class="line">            <span class="keyword">elif</span> convertEntities == self.XHTML_ENTITIES:</span><br><span class="line">                self.convertXMLEntities = <span class="keyword">True</span></span><br><span class="line">                self.convertHTMLEntities = <span class="keyword">True</span></span><br><span class="line">                self.escapeUnrecognizedEntities = <span class="keyword">False</span></span><br><span class="line">            <span class="keyword">elif</span> convertEntities == self.XML_ENTITIES:</span><br><span class="line">                self.convertXMLEntities = <span class="keyword">True</span></span><br><span class="line">                self.convertHTMLEntities = <span class="keyword">False</span></span><br><span class="line">                self.escapeUnrecognizedEntities = <span class="keyword">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.convertXMLEntities = <span class="keyword">False</span></span><br><span class="line">            self.convertHTMLEntities = <span class="keyword">False</span></span><br><span class="line">            self.escapeUnrecognizedEntities = <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line">        self.instanceSelfClosingTags = buildTagMap(<span class="keyword">None</span>, selfClosingTags)</span><br><span class="line">        SGMLParser.__init__(self)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> hasattr(markup, <span class="string">'read'</span>):        <span class="comment"># It's a file-type object.</span></span><br><span class="line">            markup = markup.read()</span><br><span class="line">        self.markup = markup</span><br><span class="line">        self.markupMassage = markupMassage</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self._feed(isHTML=isHTML)</span><br><span class="line">        <span class="keyword">except</span> StopParsing:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        self.markup = <span class="keyword">None</span>                 <span class="comment"># The markup can now be GCed</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">convert_charref</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        <span class="string">"""This method fixes a bug in Python's SGMLParser."""</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            n = int(name)</span><br><span class="line">        <span class="keyword">except</span> ValueError:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="number">0</span> &lt;= n &lt;= <span class="number">127</span> : <span class="comment"># ASCII ends at 127, not 255</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">return</span> self.convert_codepoint(n)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_feed</span><span class="params">(self, inDocumentEncoding=None, isHTML=False)</span>:</span></span><br><span class="line">        <span class="comment"># Convert the document to Unicode.</span></span><br><span class="line">        markup = self.markup</span><br><span class="line">        <span class="keyword">if</span> isinstance(markup, unicode):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> hasattr(self, <span class="string">'originalEncoding'</span>):</span><br><span class="line">                self.originalEncoding = <span class="keyword">None</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            dammit = UnicodeDammit\</span><br><span class="line">                     (markup, [self.fromEncoding, inDocumentEncoding],</span><br><span class="line">                      smartQuotesTo=self.smartQuotesTo, isHTML=isHTML)</span><br><span class="line">            markup = dammit.unicode</span><br><span class="line">            self.originalEncoding = dammit.originalEncoding</span><br><span class="line">            self.declaredHTMLEncoding = dammit.declaredHTMLEncoding</span><br><span class="line">        <span class="keyword">if</span> markup:</span><br><span class="line">            <span class="keyword">if</span> self.markupMassage:</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> hasattr(self.markupMassage, <span class="string">"__iter__"</span>):</span><br><span class="line">                    self.markupMassage = self.MARKUP_MASSAGE</span><br><span class="line">                <span class="keyword">for</span> fix, m <span class="keyword">in</span> self.markupMassage:</span><br><span class="line">                    markup = fix.sub(m, markup)</span><br><span class="line">                <span class="comment"># <span class="doctag">TODO:</span> We get rid of markupMassage so that the</span></span><br><span class="line">                <span class="comment"># soup object can be deepcopied later on. Some</span></span><br><span class="line">                <span class="comment"># Python installations can't copy regexes. If anyone</span></span><br><span class="line">                <span class="comment"># was relying on the existence of markupMassage, this</span></span><br><span class="line">                <span class="comment"># might cause problems.</span></span><br><span class="line">                <span class="keyword">del</span>(self.markupMassage)</span><br><span class="line">        self.reset()</span><br><span class="line"></span><br><span class="line">        SGMLParser.feed(self, markup)</span><br><span class="line">        <span class="comment"># Close out any unfinished strings and close all the open tags.</span></span><br><span class="line">        self.endData()</span><br><span class="line">        <span class="keyword">while</span> self.currentTag.name != self.ROOT_TAG_NAME:</span><br><span class="line">            self.popTag()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, methodName)</span>:</span></span><br><span class="line">        <span class="string">"""This method routes method call requests to either the SGMLParser</span></span><br><span class="line"><span class="string">        superclass or the Tag superclass, depending on the method name."""</span></span><br><span class="line">        <span class="comment">#print "__getattr__ called on %s.%s" % (self.__class__, methodName)</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> methodName.startswith(<span class="string">'start_'</span>) <span class="keyword">or</span> methodName.startswith(<span class="string">'end_'</span>) \</span><br><span class="line">               <span class="keyword">or</span> methodName.startswith(<span class="string">'do_'</span>):</span><br><span class="line">            <span class="keyword">return</span> SGMLParser.__getattr__(self, methodName)</span><br><span class="line">        <span class="keyword">elif</span> <span class="keyword">not</span> methodName.startswith(<span class="string">'__'</span>):</span><br><span class="line">            <span class="keyword">return</span> Tag.__getattr__(self, methodName)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> AttributeError</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isSelfClosingTag</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        <span class="string">"""Returns true iff the given string is the name of a</span></span><br><span class="line"><span class="string">        self-closing tag according to this parser."""</span></span><br><span class="line">        <span class="keyword">return</span> self.SELF_CLOSING_TAGS.has_key(name) \</span><br><span class="line">               <span class="keyword">or</span> self.instanceSelfClosingTags.has_key(name)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reset</span><span class="params">(self)</span>:</span></span><br><span class="line">        Tag.__init__(self, self, self.ROOT_TAG_NAME)</span><br><span class="line">        self.hidden = <span class="number">1</span></span><br><span class="line">        SGMLParser.reset(self)</span><br><span class="line">        self.currentData = []</span><br><span class="line">        self.currentTag = <span class="keyword">None</span></span><br><span class="line">        self.tagStack = []</span><br><span class="line">        self.quoteStack = []</span><br><span class="line">        self.pushTag(self)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">popTag</span><span class="params">(self)</span>:</span></span><br><span class="line">        tag = self.tagStack.pop()</span><br><span class="line"></span><br><span class="line">        <span class="comment">#print "Pop", tag.name</span></span><br><span class="line">        <span class="keyword">if</span> self.tagStack:</span><br><span class="line">            self.currentTag = self.tagStack[<span class="number">-1</span>]</span><br><span class="line">        <span class="keyword">return</span> self.currentTag</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pushTag</span><span class="params">(self, tag)</span>:</span></span><br><span class="line">        <span class="comment">#print "Push", tag.name</span></span><br><span class="line">        <span class="keyword">if</span> self.currentTag:</span><br><span class="line">            self.currentTag.contents.append(tag)</span><br><span class="line">        self.tagStack.append(tag)</span><br><span class="line">        self.currentTag = self.tagStack[<span class="number">-1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">endData</span><span class="params">(self, containerClass=NavigableString)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.currentData:</span><br><span class="line">            currentData = <span class="string">u''</span>.join(self.currentData)</span><br><span class="line">            <span class="keyword">if</span> (currentData.translate(self.STRIP_ASCII_SPACES) == <span class="string">''</span> <span class="keyword">and</span></span><br><span class="line">                <span class="keyword">not</span> set([tag.name <span class="keyword">for</span> tag <span class="keyword">in</span> self.tagStack]).intersection(</span><br><span class="line">                    self.PRESERVE_WHITESPACE_TAGS)):</span><br><span class="line">                <span class="keyword">if</span> <span class="string">'\n'</span> <span class="keyword">in</span> currentData:</span><br><span class="line">                    currentData = <span class="string">'\n'</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    currentData = <span class="string">' '</span></span><br><span class="line">            self.currentData = []</span><br><span class="line">            <span class="keyword">if</span> self.parseOnlyThese <span class="keyword">and</span> len(self.tagStack) &lt;= <span class="number">1</span> <span class="keyword">and</span> \</span><br><span class="line">                   (<span class="keyword">not</span> self.parseOnlyThese.text <span class="keyword">or</span> \</span><br><span class="line">                    <span class="keyword">not</span> self.parseOnlyThese.search(currentData)):</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            o = containerClass(currentData)</span><br><span class="line">            o.setup(self.currentTag, self.previous)</span><br><span class="line">            <span class="keyword">if</span> self.previous:</span><br><span class="line">                self.previous.next = o</span><br><span class="line">            self.previous = o</span><br><span class="line">            self.currentTag.contents.append(o)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_popToTag</span><span class="params">(self, name, inclusivePop=True)</span>:</span></span><br><span class="line">        <span class="string">"""Pops the tag stack up to and including the most recent</span></span><br><span class="line"><span class="string">        instance of the given tag. If inclusivePop is false, pops the tag</span></span><br><span class="line"><span class="string">        stack up to but *not* including the most recent instqance of</span></span><br><span class="line"><span class="string">        the given tag."""</span></span><br><span class="line">        <span class="comment">#print "Popping to %s" % name</span></span><br><span class="line">        <span class="keyword">if</span> name == self.ROOT_TAG_NAME:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        numPops = <span class="number">0</span></span><br><span class="line">        mostRecentTag = <span class="keyword">None</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(self.tagStack)<span class="number">-1</span>, <span class="number">0</span>, <span class="number">-1</span>):</span><br><span class="line">            <span class="keyword">if</span> name == self.tagStack[i].name:</span><br><span class="line">                numPops = len(self.tagStack)-i</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> inclusivePop:</span><br><span class="line">            numPops = numPops - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, numPops):</span><br><span class="line">            mostRecentTag = self.popTag()</span><br><span class="line">        <span class="keyword">return</span> mostRecentTag</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_smartPop</span><span class="params">(self, name)</span>:</span></span><br><span class="line"></span><br><span class="line">        <span class="string">"""We need to pop up to the previous tag of this type, unless</span></span><br><span class="line"><span class="string">        one of this tag's nesting reset triggers comes between this</span></span><br><span class="line"><span class="string">        tag and the previous tag of this type, OR unless this tag is a</span></span><br><span class="line"><span class="string">        generic nesting trigger and another generic nesting trigger</span></span><br><span class="line"><span class="string">        comes between this tag and the previous tag of this type.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Examples:</span></span><br><span class="line"><span class="string">         &lt;p&gt;Foo&lt;b&gt;Bar *&lt;p&gt;* should pop to 'p', not 'b'.</span></span><br><span class="line"><span class="string">         &lt;p&gt;Foo&lt;table&gt;Bar *&lt;p&gt;* should pop to 'table', not 'p'.</span></span><br><span class="line"><span class="string">         &lt;p&gt;Foo&lt;table&gt;&lt;tr&gt;Bar *&lt;p&gt;* should pop to 'tr', not 'p'.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">         &lt;li&gt;&lt;ul&gt;&lt;li&gt; *&lt;li&gt;* should pop to 'ul', not the first 'li'.</span></span><br><span class="line"><span class="string">         &lt;tr&gt;&lt;table&gt;&lt;tr&gt; *&lt;tr&gt;* should pop to 'table', not the first 'tr'</span></span><br><span class="line"><span class="string">         &lt;td&gt;&lt;tr&gt;&lt;td&gt; *&lt;td&gt;* should pop to 'tr', not the first 'td'</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line"></span><br><span class="line">        nestingResetTriggers = self.NESTABLE_TAGS.get(name)</span><br><span class="line">        isNestable = nestingResetTriggers != <span class="keyword">None</span></span><br><span class="line">        isResetNesting = self.RESET_NESTING_TAGS.has_key(name)</span><br><span class="line">        popTo = <span class="keyword">None</span></span><br><span class="line">        inclusive = <span class="keyword">True</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(self.tagStack)<span class="number">-1</span>, <span class="number">0</span>, <span class="number">-1</span>):</span><br><span class="line">            p = self.tagStack[i]</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">not</span> p <span class="keyword">or</span> p.name == name) <span class="keyword">and</span> <span class="keyword">not</span> isNestable:</span><br><span class="line">                <span class="comment">#Non-nestable tags get popped to the top or to their</span></span><br><span class="line">                <span class="comment">#last occurance.</span></span><br><span class="line">                popTo = name</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> (nestingResetTriggers <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span></span><br><span class="line">                <span class="keyword">and</span> p.name <span class="keyword">in</span> nestingResetTriggers) \</span><br><span class="line">                <span class="keyword">or</span> (nestingResetTriggers <span class="keyword">is</span> <span class="keyword">None</span> <span class="keyword">and</span> isResetNesting</span><br><span class="line">                    <span class="keyword">and</span> self.RESET_NESTING_TAGS.has_key(p.name)):</span><br><span class="line"></span><br><span class="line">                <span class="comment">#If we encounter one of the nesting reset triggers</span></span><br><span class="line">                <span class="comment">#peculiar to this tag, or we encounter another tag</span></span><br><span class="line">                <span class="comment">#that causes nesting to reset, pop up to but not</span></span><br><span class="line">                <span class="comment">#including that tag.</span></span><br><span class="line">                popTo = p.name</span><br><span class="line">                inclusive = <span class="keyword">False</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            p = p.parent</span><br><span class="line">        <span class="keyword">if</span> popTo:</span><br><span class="line">            self._popToTag(popTo, inclusive)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">unknown_starttag</span><span class="params">(self, name, attrs, selfClosing=<span class="number">0</span>)</span>:</span></span><br><span class="line">        <span class="comment">#print "Start tag %s: %s" % (name, attrs)</span></span><br><span class="line">        <span class="keyword">if</span> self.quoteStack:</span><br><span class="line">            <span class="comment">#This is not a real tag.</span></span><br><span class="line">            <span class="comment">#print "&lt;%s&gt; is not real!" % name</span></span><br><span class="line">            attrs = <span class="string">''</span>.join([<span class="string">' %s="%s"'</span> % (x, y) <span class="keyword">for</span> x, y <span class="keyword">in</span> attrs])</span><br><span class="line">            self.handle_data(<span class="string">'&lt;%s%s&gt;'</span> % (name, attrs))</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        self.endData()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.isSelfClosingTag(name) <span class="keyword">and</span> <span class="keyword">not</span> selfClosing:</span><br><span class="line">            self._smartPop(name)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.parseOnlyThese <span class="keyword">and</span> len(self.tagStack) &lt;= <span class="number">1</span> \</span><br><span class="line">               <span class="keyword">and</span> (self.parseOnlyThese.text <span class="keyword">or</span> <span class="keyword">not</span> self.parseOnlyThese.searchTag(name, attrs)):</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        tag = Tag(self, name, attrs, self.currentTag, self.previous)</span><br><span class="line">        <span class="keyword">if</span> self.previous:</span><br><span class="line">            self.previous.next = tag</span><br><span class="line">        self.previous = tag</span><br><span class="line">        self.pushTag(tag)</span><br><span class="line">        <span class="keyword">if</span> selfClosing <span class="keyword">or</span> self.isSelfClosingTag(name):</span><br><span class="line">            self.popTag()</span><br><span class="line">        <span class="keyword">if</span> name <span class="keyword">in</span> self.QUOTE_TAGS:</span><br><span class="line">            <span class="comment">#print "Beginning quote (%s)" % name</span></span><br><span class="line">            self.quoteStack.append(name)</span><br><span class="line">            self.literal = <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> tag</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">unknown_endtag</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        <span class="comment">#print "End tag %s" % name</span></span><br><span class="line">        <span class="keyword">if</span> self.quoteStack <span class="keyword">and</span> self.quoteStack[<span class="number">-1</span>] != name:</span><br><span class="line">            <span class="comment">#This is not a real end tag.</span></span><br><span class="line">            <span class="comment">#print "&lt;/%s&gt; is not real!" % name</span></span><br><span class="line">            self.handle_data(<span class="string">'&lt;/%s&gt;'</span> % name)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        self.endData()</span><br><span class="line">        self._popToTag(name)</span><br><span class="line">        <span class="keyword">if</span> self.quoteStack <span class="keyword">and</span> self.quoteStack[<span class="number">-1</span>] == name:</span><br><span class="line">            self.quoteStack.pop()</span><br><span class="line">            self.literal = (len(self.quoteStack) &gt; <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_data</span><span class="params">(self, data)</span>:</span></span><br><span class="line">        self.currentData.append(data)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_toStringSubclass</span><span class="params">(self, text, subclass)</span>:</span></span><br><span class="line">        <span class="string">"""Adds a certain piece of text to the tree as a NavigableString</span></span><br><span class="line"><span class="string">        subclass."""</span></span><br><span class="line">        self.endData()</span><br><span class="line">        self.handle_data(text)</span><br><span class="line">        self.endData(subclass)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_pi</span><span class="params">(self, text)</span>:</span></span><br><span class="line">        <span class="string">"""Handle a processing instruction as a ProcessingInstruction</span></span><br><span class="line"><span class="string">        object, possibly one with a %SOUP-ENCODING% slot into which an</span></span><br><span class="line"><span class="string">        encoding will be plugged later."""</span></span><br><span class="line">        <span class="keyword">if</span> text[:<span class="number">3</span>] == <span class="string">"xml"</span>:</span><br><span class="line">            text = <span class="string">u"xml version='1.0' encoding='%SOUP-ENCODING%'"</span></span><br><span class="line">        self._toStringSubclass(text, ProcessingInstruction)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_comment</span><span class="params">(self, text)</span>:</span></span><br><span class="line">        <span class="string">"Handle comments as Comment objects."</span></span><br><span class="line">        self._toStringSubclass(text, Comment)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_charref</span><span class="params">(self, ref)</span>:</span></span><br><span class="line">        <span class="string">"Handle character references as data."</span></span><br><span class="line">        <span class="keyword">if</span> self.convertEntities:</span><br><span class="line">            data = unichr(int(ref))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            data = <span class="string">'&amp;#%s;'</span> % ref</span><br><span class="line">        self.handle_data(data)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_entityref</span><span class="params">(self, ref)</span>:</span></span><br><span class="line">        <span class="string">"""Handle entity references as data, possibly converting known</span></span><br><span class="line"><span class="string">        HTML and/or XML entity references to the corresponding Unicode</span></span><br><span class="line"><span class="string">        characters."""</span></span><br><span class="line">        data = <span class="keyword">None</span></span><br><span class="line">        <span class="keyword">if</span> self.convertHTMLEntities:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                data = unichr(name2codepoint[ref])</span><br><span class="line">            <span class="keyword">except</span> KeyError:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data <span class="keyword">and</span> self.convertXMLEntities:</span><br><span class="line">                data = self.XML_ENTITIES_TO_SPECIAL_CHARS.get(ref)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data <span class="keyword">and</span> self.convertHTMLEntities <span class="keyword">and</span> \</span><br><span class="line">            <span class="keyword">not</span> self.XML_ENTITIES_TO_SPECIAL_CHARS.get(ref):</span><br><span class="line">                <span class="comment"># <span class="doctag">TODO:</span> We've got a problem here. We're told this is</span></span><br><span class="line">                <span class="comment"># an entity reference, but it's not an XML entity</span></span><br><span class="line">                <span class="comment"># reference or an HTML entity reference. Nonetheless,</span></span><br><span class="line">                <span class="comment"># the logical thing to do is to pass it through as an</span></span><br><span class="line">                <span class="comment"># unrecognized entity reference.</span></span><br><span class="line">                <span class="comment">#</span></span><br><span class="line">                <span class="comment"># Except: when the input is "&amp;carol;" this function</span></span><br><span class="line">                <span class="comment"># will be called with input "carol". When the input is</span></span><br><span class="line">                <span class="comment"># "AT&amp;T", this function will be called with input</span></span><br><span class="line">                <span class="comment"># "T". We have no way of knowing whether a semicolon</span></span><br><span class="line">                <span class="comment"># was present originally, so we don't know whether</span></span><br><span class="line">                <span class="comment"># this is an unknown entity or just a misplaced</span></span><br><span class="line">                <span class="comment"># ampersand.</span></span><br><span class="line">                <span class="comment">#</span></span><br><span class="line">                <span class="comment"># The more common case is a misplaced ampersand, so I</span></span><br><span class="line">                <span class="comment"># escape the ampersand and omit the trailing semicolon.</span></span><br><span class="line">                data = <span class="string">"&amp;amp;%s"</span> % ref</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">            <span class="comment"># This case is different from the one above, because we</span></span><br><span class="line">            <span class="comment"># haven't already gone through a supposedly comprehensive</span></span><br><span class="line">            <span class="comment"># mapping of entities to Unicode characters. We might not</span></span><br><span class="line">            <span class="comment"># have gone through any mapping at all. So the chances are</span></span><br><span class="line">            <span class="comment"># very high that this is a real entity, and not a</span></span><br><span class="line">            <span class="comment"># misplaced ampersand.</span></span><br><span class="line">            data = <span class="string">"&amp;%s;"</span> % ref</span><br><span class="line">        self.handle_data(data)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_decl</span><span class="params">(self, data)</span>:</span></span><br><span class="line">        <span class="string">"Handle DOCTYPEs and the like as Declaration objects."</span></span><br><span class="line">        self._toStringSubclass(data, Declaration)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse_declaration</span><span class="params">(self, i)</span>:</span></span><br><span class="line">        <span class="string">"""Treat a bogus SGML declaration as raw data. Treat a CDATA</span></span><br><span class="line"><span class="string">        declaration as a CData object."""</span></span><br><span class="line">        j = <span class="keyword">None</span></span><br><span class="line">        <span class="keyword">if</span> self.rawdata[i:i+<span class="number">9</span>] == <span class="string">'&lt;![CDATA['</span>:</span><br><span class="line">             k = self.rawdata.find(<span class="string">']]&gt;'</span>, i)</span><br><span class="line">             <span class="keyword">if</span> k == <span class="number">-1</span>:</span><br><span class="line">                 k = len(self.rawdata)</span><br><span class="line">             data = self.rawdata[i+<span class="number">9</span>:k]</span><br><span class="line">             j = k+<span class="number">3</span></span><br><span class="line">             self._toStringSubclass(data, CData)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                j = SGMLParser.parse_declaration(self, i)</span><br><span class="line">            <span class="keyword">except</span> SGMLParseError:</span><br><span class="line">                toHandle = self.rawdata[i:]</span><br><span class="line">                self.handle_data(toHandle)</span><br><span class="line">                j = i + len(toHandle)</span><br><span class="line">        <span class="keyword">return</span> j</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BeautifulSoup</span><span class="params">(BeautifulStoneSoup)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="string">"""This parser knows the following facts about HTML:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    * Some tags have no closing tag and should be interpreted as being</span></span><br><span class="line"><span class="string">      closed as soon as they are encountered.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    * The text inside some tags (ie. 'script') may contain tags which</span></span><br><span class="line"><span class="string">      are not really part of the document and which should be parsed</span></span><br><span class="line"><span class="string">      as text, not tags. If you want to parse the text as tags, you can</span></span><br><span class="line"><span class="string">      always fetch it and parse it explicitly.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    * Tag nesting rules:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">      Most tags can't be nested at all. For instance, the occurance of</span></span><br><span class="line"><span class="string">      a &lt;p&gt; tag should implicitly close the previous &lt;p&gt; tag.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       &lt;p&gt;Para1&lt;p&gt;Para2</span></span><br><span class="line"><span class="string">        should be transformed into:</span></span><br><span class="line"><span class="string">       &lt;p&gt;Para1&lt;/p&gt;&lt;p&gt;Para2</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">      Some tags can be nested arbitrarily. For instance, the occurance</span></span><br><span class="line"><span class="string">      of a &lt;blockquote&gt; tag should _not_ implicitly close the previous</span></span><br><span class="line"><span class="string">      &lt;blockquote&gt; tag.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       Alice said: &lt;blockquote&gt;Bob said: &lt;blockquote&gt;Blah</span></span><br><span class="line"><span class="string">        should NOT be transformed into:</span></span><br><span class="line"><span class="string">       Alice said: &lt;blockquote&gt;Bob said: &lt;/blockquote&gt;&lt;blockquote&gt;Blah</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">      Some tags can be nested, but the nesting is reset by the</span></span><br><span class="line"><span class="string">      interposition of other tags. For instance, a &lt;tr&gt; tag should</span></span><br><span class="line"><span class="string">      implicitly close the previous &lt;tr&gt; tag within the same &lt;table&gt;,</span></span><br><span class="line"><span class="string">      but not close a &lt;tr&gt; tag in another table.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       &lt;table&gt;&lt;tr&gt;Blah&lt;tr&gt;Blah</span></span><br><span class="line"><span class="string">        should be transformed into:</span></span><br><span class="line"><span class="string">       &lt;table&gt;&lt;tr&gt;Blah&lt;/tr&gt;&lt;tr&gt;Blah</span></span><br><span class="line"><span class="string">        but,</span></span><br><span class="line"><span class="string">       &lt;tr&gt;Blah&lt;table&gt;&lt;tr&gt;Blah</span></span><br><span class="line"><span class="string">        should NOT be transformed into</span></span><br><span class="line"><span class="string">       &lt;tr&gt;Blah&lt;table&gt;&lt;/tr&gt;&lt;tr&gt;Blah</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Differing assumptions about tag nesting rules are a major source</span></span><br><span class="line"><span class="string">    of problems with the BeautifulSoup class. If BeautifulSoup is not</span></span><br><span class="line"><span class="string">    treating as nestable a tag your page author treats as nestable,</span></span><br><span class="line"><span class="string">    try ICantBelieveItsBeautifulSoup, MinimalSoup, or</span></span><br><span class="line"><span class="string">    BeautifulStoneSoup before writing your own subclass."""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> kwargs.has_key(<span class="string">'smartQuotesTo'</span>):</span><br><span class="line">            kwargs[<span class="string">'smartQuotesTo'</span>] = self.HTML_ENTITIES</span><br><span class="line">        kwargs[<span class="string">'isHTML'</span>] = <span class="keyword">True</span></span><br><span class="line">        BeautifulStoneSoup.__init__(self, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">    SELF_CLOSING_TAGS = buildTagMap(<span class="keyword">None</span>,</span><br><span class="line">                                    (<span class="string">'br'</span> , <span class="string">'hr'</span>, <span class="string">'input'</span>, <span class="string">'img'</span>, <span class="string">'meta'</span>,</span><br><span class="line">                                    <span class="string">'spacer'</span>, <span class="string">'link'</span>, <span class="string">'frame'</span>, <span class="string">'base'</span>, <span class="string">'col'</span>))</span><br><span class="line"></span><br><span class="line">    PRESERVE_WHITESPACE_TAGS = set([<span class="string">'pre'</span>, <span class="string">'textarea'</span>])</span><br><span class="line"></span><br><span class="line">    QUOTE_TAGS = &#123;<span class="string">'script'</span> : <span class="keyword">None</span>, <span class="string">'textarea'</span> : <span class="keyword">None</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#According to the HTML standard, each of these inline tags can</span></span><br><span class="line">    <span class="comment">#contain another tag of the same type. Furthermore, it's common</span></span><br><span class="line">    <span class="comment">#to actually use these tags this way.</span></span><br><span class="line">    NESTABLE_INLINE_TAGS = (<span class="string">'span'</span>, <span class="string">'font'</span>, <span class="string">'q'</span>, <span class="string">'object'</span>, <span class="string">'bdo'</span>, <span class="string">'sub'</span>, <span class="string">'sup'</span>,</span><br><span class="line">                            <span class="string">'center'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#According to the HTML standard, these block tags can contain</span></span><br><span class="line">    <span class="comment">#another tag of the same type. Furthermore, it's common</span></span><br><span class="line">    <span class="comment">#to actually use these tags this way.</span></span><br><span class="line">    NESTABLE_BLOCK_TAGS = (<span class="string">'blockquote'</span>, <span class="string">'div'</span>, <span class="string">'fieldset'</span>, <span class="string">'ins'</span>, <span class="string">'del'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#Lists can contain other lists, but there are restrictions.</span></span><br><span class="line">    NESTABLE_LIST_TAGS = &#123; <span class="string">'ol'</span> : [],</span><br><span class="line">                           <span class="string">'ul'</span> : [],</span><br><span class="line">                           <span class="string">'li'</span> : [<span class="string">'ul'</span>, <span class="string">'ol'</span>],</span><br><span class="line">                           <span class="string">'dl'</span> : [],</span><br><span class="line">                           <span class="string">'dd'</span> : [<span class="string">'dl'</span>],</span><br><span class="line">                           <span class="string">'dt'</span> : [<span class="string">'dl'</span>] &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">#Tables can contain other tables, but there are restrictions.</span></span><br><span class="line">    NESTABLE_TABLE_TAGS = &#123;<span class="string">'table'</span> : [],</span><br><span class="line">                           <span class="string">'tr'</span> : [<span class="string">'table'</span>, <span class="string">'tbody'</span>, <span class="string">'tfoot'</span>, <span class="string">'thead'</span>],</span><br><span class="line">                           <span class="string">'td'</span> : [<span class="string">'tr'</span>],</span><br><span class="line">                           <span class="string">'th'</span> : [<span class="string">'tr'</span>],</span><br><span class="line">                           <span class="string">'thead'</span> : [<span class="string">'table'</span>],</span><br><span class="line">                           <span class="string">'tbody'</span> : [<span class="string">'table'</span>],</span><br><span class="line">                           <span class="string">'tfoot'</span> : [<span class="string">'table'</span>],</span><br><span class="line">                           &#125;</span><br><span class="line"></span><br><span class="line">    NON_NESTABLE_BLOCK_TAGS = (<span class="string">'address'</span>, <span class="string">'form'</span>, <span class="string">'p'</span>, <span class="string">'pre'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#If one of these tags is encountered, all tags up to the next tag of</span></span><br><span class="line">    <span class="comment">#this type are popped.</span></span><br><span class="line">    RESET_NESTING_TAGS = buildTagMap(<span class="keyword">None</span>, NESTABLE_BLOCK_TAGS, <span class="string">'noscript'</span>,</span><br><span class="line">                                     NON_NESTABLE_BLOCK_TAGS,</span><br><span class="line">                                     NESTABLE_LIST_TAGS,</span><br><span class="line">                                     NESTABLE_TABLE_TAGS)</span><br><span class="line"></span><br><span class="line">    NESTABLE_TAGS = buildTagMap([], NESTABLE_INLINE_TAGS, NESTABLE_BLOCK_TAGS,</span><br><span class="line">                                NESTABLE_LIST_TAGS, NESTABLE_TABLE_TAGS)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Used to detect the charset in a META tag; see start_meta</span></span><br><span class="line">    CHARSET_RE = re.compile(<span class="string">"((^|;)\s*charset=)([^;]*)"</span>, re.M)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">start_meta</span><span class="params">(self, attrs)</span>:</span></span><br><span class="line">        <span class="string">"""Beautiful Soup can detect a charset included in a META tag,</span></span><br><span class="line"><span class="string">        try to convert the document to that charset, and re-parse the</span></span><br><span class="line"><span class="string">        document from the beginning."""</span></span><br><span class="line">        httpEquiv = <span class="keyword">None</span></span><br><span class="line">        contentType = <span class="keyword">None</span></span><br><span class="line">        contentTypeIndex = <span class="keyword">None</span></span><br><span class="line">        tagNeedsEncodingSubstitution = <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(attrs)):</span><br><span class="line">            key, value = attrs[i]</span><br><span class="line">            key = key.lower()</span><br><span class="line">            <span class="keyword">if</span> key == <span class="string">'http-equiv'</span>:</span><br><span class="line">                httpEquiv = value</span><br><span class="line">            <span class="keyword">elif</span> key == <span class="string">'content'</span>:</span><br><span class="line">                contentType = value</span><br><span class="line">                contentTypeIndex = i</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> httpEquiv <span class="keyword">and</span> contentType: <span class="comment"># It's an interesting meta tag.</span></span><br><span class="line">            match = self.CHARSET_RE.search(contentType)</span><br><span class="line">            <span class="keyword">if</span> match:</span><br><span class="line">                <span class="keyword">if</span> (self.declaredHTMLEncoding <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span> <span class="keyword">or</span></span><br><span class="line">                    self.originalEncoding == self.fromEncoding):</span><br><span class="line">                    <span class="comment"># An HTML encoding was sniffed while converting</span></span><br><span class="line">                    <span class="comment"># the document to Unicode, or an HTML encoding was</span></span><br><span class="line">                    <span class="comment"># sniffed during a previous pass through the</span></span><br><span class="line">                    <span class="comment"># document, or an encoding was specified</span></span><br><span class="line">                    <span class="comment"># explicitly and it worked. Rewrite the meta tag.</span></span><br><span class="line">                    <span class="function"><span class="keyword">def</span> <span class="title">rewrite</span><span class="params">(match)</span>:</span></span><br><span class="line">                        <span class="keyword">return</span> match.group(<span class="number">1</span>) + <span class="string">"%SOUP-ENCODING%"</span></span><br><span class="line">                    newAttr = self.CHARSET_RE.sub(rewrite, contentType)</span><br><span class="line">                    attrs[contentTypeIndex] = (attrs[contentTypeIndex][<span class="number">0</span>],</span><br><span class="line">                                               newAttr)</span><br><span class="line">                    tagNeedsEncodingSubstitution = <span class="keyword">True</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="comment"># This is our first pass through the document.</span></span><br><span class="line">                    <span class="comment"># Go through it again with the encoding information.</span></span><br><span class="line">                    newCharset = match.group(<span class="number">3</span>)</span><br><span class="line">                    <span class="keyword">if</span> newCharset <span class="keyword">and</span> newCharset != self.originalEncoding:</span><br><span class="line">                        self.declaredHTMLEncoding = newCharset</span><br><span class="line">                        self._feed(self.declaredHTMLEncoding)</span><br><span class="line">                        <span class="keyword">raise</span> StopParsing</span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line">        tag = self.unknown_starttag(<span class="string">"meta"</span>, attrs)</span><br><span class="line">        <span class="keyword">if</span> tag <span class="keyword">and</span> tagNeedsEncodingSubstitution:</span><br><span class="line">            tag.containsSubstitutions = <span class="keyword">True</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StopParsing</span><span class="params">(Exception)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ICantBelieveItsBeautifulSoup</span><span class="params">(BeautifulSoup)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="string">"""The BeautifulSoup class is oriented towards skipping over</span></span><br><span class="line"><span class="string">    common HTML errors like unclosed tags. However, sometimes it makes</span></span><br><span class="line"><span class="string">    errors of its own. For instance, consider this fragment:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">     &lt;b&gt;Foo&lt;b&gt;Bar&lt;/b&gt;&lt;/b&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    This is perfectly valid (if bizarre) HTML. However, the</span></span><br><span class="line"><span class="string">    BeautifulSoup class will implicitly close the first b tag when it</span></span><br><span class="line"><span class="string">    encounters the second 'b'. It will think the author wrote</span></span><br><span class="line"><span class="string">    "&lt;b&gt;Foo&lt;b&gt;Bar", and didn't close the first 'b' tag, because</span></span><br><span class="line"><span class="string">    there's no real-world reason to bold something that's already</span></span><br><span class="line"><span class="string">    bold. When it encounters '&lt;/b&gt;&lt;/b&gt;' it will close two more 'b'</span></span><br><span class="line"><span class="string">    tags, for a grand total of three tags closed instead of two. This</span></span><br><span class="line"><span class="string">    can throw off the rest of your document structure. The same is</span></span><br><span class="line"><span class="string">    true of a number of other tags, listed below.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    It's much more common for someone to forget to close a 'b' tag</span></span><br><span class="line"><span class="string">    than to actually use nested 'b' tags, and the BeautifulSoup class</span></span><br><span class="line"><span class="string">    handles the common case. This class handles the not-co-common</span></span><br><span class="line"><span class="string">    case: where you can't believe someone wrote what they did, but</span></span><br><span class="line"><span class="string">    it's valid HTML and BeautifulSoup screwed up by assuming it</span></span><br><span class="line"><span class="string">    wouldn't be."""</span></span><br><span class="line"></span><br><span class="line">    I_CANT_BELIEVE_THEYRE_NESTABLE_INLINE_TAGS = \</span><br><span class="line">     (<span class="string">'em'</span>, <span class="string">'big'</span>, <span class="string">'i'</span>, <span class="string">'small'</span>, <span class="string">'tt'</span>, <span class="string">'abbr'</span>, <span class="string">'acronym'</span>, <span class="string">'strong'</span>,</span><br><span class="line">      <span class="string">'cite'</span>, <span class="string">'code'</span>, <span class="string">'dfn'</span>, <span class="string">'kbd'</span>, <span class="string">'samp'</span>, <span class="string">'strong'</span>, <span class="string">'var'</span>, <span class="string">'b'</span>,</span><br><span class="line">      <span class="string">'big'</span>)</span><br><span class="line"></span><br><span class="line">    I_CANT_BELIEVE_THEYRE_NESTABLE_BLOCK_TAGS = (<span class="string">'noscript'</span>,)</span><br><span class="line"></span><br><span class="line">    NESTABLE_TAGS = buildTagMap([], BeautifulSoup.NESTABLE_TAGS,</span><br><span class="line">                                I_CANT_BELIEVE_THEYRE_NESTABLE_BLOCK_TAGS,</span><br><span class="line">                                I_CANT_BELIEVE_THEYRE_NESTABLE_INLINE_TAGS)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MinimalSoup</span><span class="params">(BeautifulSoup)</span>:</span></span><br><span class="line">    <span class="string">"""The MinimalSoup class is for parsing HTML that contains</span></span><br><span class="line"><span class="string">    pathologically bad markup. It makes no assumptions about tag</span></span><br><span class="line"><span class="string">    nesting, but it does know which tags are self-closing, that</span></span><br><span class="line"><span class="string">    &lt;script&gt; tags contain Javascript and should not be parsed, that</span></span><br><span class="line"><span class="string">    META tags may contain encoding information, and so on.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    This also makes it better for subclassing than BeautifulStoneSoup</span></span><br><span class="line"><span class="string">    or BeautifulSoup."""</span></span><br><span class="line"></span><br><span class="line">    RESET_NESTING_TAGS = buildTagMap(<span class="string">'noscript'</span>)</span><br><span class="line">    NESTABLE_TAGS = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BeautifulSOAP</span><span class="params">(BeautifulStoneSoup)</span>:</span></span><br><span class="line">    <span class="string">"""This class will push a tag with only a single string child into</span></span><br><span class="line"><span class="string">    the tag's parent as an attribute. The attribute's name is the tag</span></span><br><span class="line"><span class="string">    name, and the value is the string child. An example should give</span></span><br><span class="line"><span class="string">    the flavor of the change:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &lt;foo&gt;&lt;bar&gt;baz&lt;/bar&gt;&lt;/foo&gt;</span></span><br><span class="line"><span class="string">     =&gt;</span></span><br><span class="line"><span class="string">    &lt;foo bar="baz"&gt;&lt;bar&gt;baz&lt;/bar&gt;&lt;/foo&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    You can then access fooTag['bar'] instead of fooTag.barTag.string.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    This is, of course, useful for scraping structures that tend to</span></span><br><span class="line"><span class="string">    use subelements instead of attributes, such as SOAP messages. Note</span></span><br><span class="line"><span class="string">    that it modifies its input, so don't print the modified version</span></span><br><span class="line"><span class="string">    out.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    I'm not sure how many people really want to use this class; let me</span></span><br><span class="line"><span class="string">    know if you do. Mainly I like the name."""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">popTag</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> len(self.tagStack) &gt; <span class="number">1</span>:</span><br><span class="line">            tag = self.tagStack[<span class="number">-1</span>]</span><br><span class="line">            parent = self.tagStack[<span class="number">-2</span>]</span><br><span class="line">            parent._getAttrMap()</span><br><span class="line">            <span class="keyword">if</span> (isinstance(tag, Tag) <span class="keyword">and</span> len(tag.contents) == <span class="number">1</span> <span class="keyword">and</span></span><br><span class="line">                isinstance(tag.contents[<span class="number">0</span>], NavigableString) <span class="keyword">and</span></span><br><span class="line">                <span class="keyword">not</span> parent.attrMap.has_key(tag.name)):</span><br><span class="line">                parent[tag.name] = tag.contents[<span class="number">0</span>]</span><br><span class="line">        BeautifulStoneSoup.popTag(self)</span><br><span class="line"></span><br><span class="line"><span class="comment">#Enterprise class names! It has come to our attention that some people</span></span><br><span class="line"><span class="comment">#think the names of the Beautiful Soup parser classes are too silly</span></span><br><span class="line"><span class="comment">#and "unprofessional" for use in enterprise screen-scraping. We feel</span></span><br><span class="line"><span class="comment">#your pain! For such-minded folk, the Beautiful Soup Consortium And</span></span><br><span class="line"><span class="comment">#All-Night Kosher Bakery recommends renaming this file to</span></span><br><span class="line"><span class="comment">#"RobustParser.py" (or, in cases of extreme enterprisiness,</span></span><br><span class="line"><span class="comment">#"RobustParserBeanInterface.class") and using the following</span></span><br><span class="line"><span class="comment">#enterprise-friendly class aliases:</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RobustXMLParser</span><span class="params">(BeautifulStoneSoup)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RobustHTMLParser</span><span class="params">(BeautifulSoup)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RobustWackAssHTMLParser</span><span class="params">(ICantBelieveItsBeautifulSoup)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RobustInsanelyWackAssHTMLParser</span><span class="params">(MinimalSoup)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimplifyingSOAPParser</span><span class="params">(BeautifulSOAP)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment">######################################################</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Bonus library: Unicode, Dammit</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># This class forces XML data into a standard format (usually to UTF-8</span></span><br><span class="line"><span class="comment"># or Unicode).  It is heavily based on code from Mark Pilgrim's</span></span><br><span class="line"><span class="comment"># Universal Feed Parser. It does not rewrite the XML or HTML to</span></span><br><span class="line"><span class="comment"># reflect a new encoding: that happens in BeautifulStoneSoup.handle_pi</span></span><br><span class="line"><span class="comment"># (XML) and BeautifulSoup.start_meta (HTML).</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Autodetects character encodings.</span></span><br><span class="line"><span class="comment"># Download from http://chardet.feedparser.org/</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">import</span> chardet</span><br><span class="line"><span class="comment">#    import chardet.constants</span></span><br><span class="line"><span class="comment">#    chardet.constants._debug = 1</span></span><br><span class="line"><span class="keyword">except</span> ImportError:</span><br><span class="line">    chardet = <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># cjkcodecs and iconv_codec make Python know about more character encodings.</span></span><br><span class="line"><span class="comment"># Both are available from http://cjkpython.i18n.org/</span></span><br><span class="line"><span class="comment"># They're built in if you use Python 2.4.</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">import</span> cjkcodecs.aliases</span><br><span class="line"><span class="keyword">except</span> ImportError:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">import</span> iconv_codec</span><br><span class="line"><span class="keyword">except</span> ImportError:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UnicodeDammit</span>:</span></span><br><span class="line">    <span class="string">"""A class for detecting the encoding of a *ML document and</span></span><br><span class="line"><span class="string">    converting it to a Unicode string. If the source encoding is</span></span><br><span class="line"><span class="string">    windows-1252, can replace MS smart quotes with their HTML or XML</span></span><br><span class="line"><span class="string">    equivalents."""</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># This dictionary maps commonly seen values for "charset" in HTML</span></span><br><span class="line">    <span class="comment"># meta tags to the corresponding Python codec names. It only covers</span></span><br><span class="line">    <span class="comment"># values that aren't in Python's aliases and can't be determined</span></span><br><span class="line">    <span class="comment"># by the heuristics in find_codec.</span></span><br><span class="line">    CHARSET_ALIASES = &#123; <span class="string">"macintosh"</span> : <span class="string">"mac-roman"</span>,</span><br><span class="line">                        <span class="string">"x-sjis"</span> : <span class="string">"shift-jis"</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, markup, overrideEncodings=[],</span></span></span><br><span class="line"><span class="function"><span class="params">                 smartQuotesTo=<span class="string">'xml'</span>, isHTML=False)</span>:</span></span><br><span class="line">        self.declaredHTMLEncoding = <span class="keyword">None</span></span><br><span class="line">        self.markup, documentEncoding, sniffedEncoding = \</span><br><span class="line">                     self._detectEncoding(markup, isHTML)</span><br><span class="line">        self.smartQuotesTo = smartQuotesTo</span><br><span class="line">        self.triedEncodings = []</span><br><span class="line">        <span class="keyword">if</span> markup == <span class="string">''</span> <span class="keyword">or</span> isinstance(markup, unicode):</span><br><span class="line">            self.originalEncoding = <span class="keyword">None</span></span><br><span class="line">            self.unicode = unicode(markup)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        u = <span class="keyword">None</span></span><br><span class="line">        <span class="keyword">for</span> proposedEncoding <span class="keyword">in</span> overrideEncodings:</span><br><span class="line">            u = self._convertFrom(proposedEncoding)</span><br><span class="line">            <span class="keyword">if</span> u: <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> u:</span><br><span class="line">            <span class="keyword">for</span> proposedEncoding <span class="keyword">in</span> (documentEncoding, sniffedEncoding):</span><br><span class="line">                u = self._convertFrom(proposedEncoding)</span><br><span class="line">                <span class="keyword">if</span> u: <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># If no luck and we have auto-detection library, try that:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> u <span class="keyword">and</span> chardet <span class="keyword">and</span> <span class="keyword">not</span> isinstance(self.markup, unicode):</span><br><span class="line">            u = self._convertFrom(chardet.detect(self.markup)[<span class="string">'encoding'</span>])</span><br><span class="line"></span><br><span class="line">        <span class="comment"># As a last resort, try utf-8 and windows-1252:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> u:</span><br><span class="line">            <span class="keyword">for</span> proposed_encoding <span class="keyword">in</span> (<span class="string">"utf-8"</span>, <span class="string">"windows-1252"</span>):</span><br><span class="line">                u = self._convertFrom(proposed_encoding)</span><br><span class="line">                <span class="keyword">if</span> u: <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        self.unicode = u</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> u: self.originalEncoding = <span class="keyword">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_subMSChar</span><span class="params">(self, orig)</span>:</span></span><br><span class="line">        <span class="string">"""Changes a MS smart quote character to an XML or HTML</span></span><br><span class="line"><span class="string">        entity."""</span></span><br><span class="line">        sub = self.MS_CHARS.get(orig)</span><br><span class="line">        <span class="keyword">if</span> isinstance(sub, tuple):</span><br><span class="line">            <span class="keyword">if</span> self.smartQuotesTo == <span class="string">'xml'</span>:</span><br><span class="line">                sub = <span class="string">'&amp;#x%s;'</span> % sub[<span class="number">1</span>]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                sub = <span class="string">'&amp;%s;'</span> % sub[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">return</span> sub</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_convertFrom</span><span class="params">(self, proposed)</span>:</span></span><br><span class="line">        proposed = self.find_codec(proposed)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> proposed <span class="keyword">or</span> proposed <span class="keyword">in</span> self.triedEncodings:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line">        self.triedEncodings.append(proposed)</span><br><span class="line">        markup = self.markup</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Convert smart quotes to HTML if coming from an encoding</span></span><br><span class="line">        <span class="comment"># that might have them.</span></span><br><span class="line">        <span class="keyword">if</span> self.smartQuotesTo <span class="keyword">and</span> proposed.lower() <span class="keyword">in</span>(<span class="string">"windows-1252"</span>,</span><br><span class="line">                                                      <span class="string">"iso-8859-1"</span>,</span><br><span class="line">                                                      <span class="string">"iso-8859-2"</span>):</span><br><span class="line">            markup = re.compile(<span class="string">"([\x80-\x9f])"</span>).sub \</span><br><span class="line">                     (<span class="keyword">lambda</span>(x): self._subMSChar(x.group(<span class="number">1</span>)),</span><br><span class="line">                      markup)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># print "Trying to convert document to %s" % proposed</span></span><br><span class="line">            u = self._toUnicode(markup, proposed)</span><br><span class="line">            self.markup = u</span><br><span class="line">            self.originalEncoding = proposed</span><br><span class="line">        <span class="keyword">except</span> Exception, e:</span><br><span class="line">            <span class="comment"># print "That didn't work!"</span></span><br><span class="line">            <span class="comment"># print e</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">None</span></span><br><span class="line">        <span class="comment">#print "Correct encoding: %s" % proposed</span></span><br><span class="line">        <span class="keyword">return</span> self.markup</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_toUnicode</span><span class="params">(self, data, encoding)</span>:</span></span><br><span class="line">        <span class="string">'''Given a string and its encoding, decodes the string into Unicode.</span></span><br><span class="line"><span class="string">        %encoding is a string recognized by encodings.aliases'''</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># strip Byte Order Mark (if present)</span></span><br><span class="line">        <span class="keyword">if</span> (len(data) &gt;= <span class="number">4</span>) <span class="keyword">and</span> (data[:<span class="number">2</span>] == <span class="string">'\xfe\xff'</span>) \</span><br><span class="line">               <span class="keyword">and</span> (data[<span class="number">2</span>:<span class="number">4</span>] != <span class="string">'\x00\x00'</span>):</span><br><span class="line">            encoding = <span class="string">'utf-16be'</span></span><br><span class="line">            data = data[<span class="number">2</span>:]</span><br><span class="line">        <span class="keyword">elif</span> (len(data) &gt;= <span class="number">4</span>) <span class="keyword">and</span> (data[:<span class="number">2</span>] == <span class="string">'\xff\xfe'</span>) \</span><br><span class="line">                 <span class="keyword">and</span> (data[<span class="number">2</span>:<span class="number">4</span>] != <span class="string">'\x00\x00'</span>):</span><br><span class="line">            encoding = <span class="string">'utf-16le'</span></span><br><span class="line">            data = data[<span class="number">2</span>:]</span><br><span class="line">        <span class="keyword">elif</span> data[:<span class="number">3</span>] == <span class="string">'\xef\xbb\xbf'</span>:</span><br><span class="line">            encoding = <span class="string">'utf-8'</span></span><br><span class="line">            data = data[<span class="number">3</span>:]</span><br><span class="line">        <span class="keyword">elif</span> data[:<span class="number">4</span>] == <span class="string">'\x00\x00\xfe\xff'</span>:</span><br><span class="line">            encoding = <span class="string">'utf-32be'</span></span><br><span class="line">            data = data[<span class="number">4</span>:]</span><br><span class="line">        <span class="keyword">elif</span> data[:<span class="number">4</span>] == <span class="string">'\xff\xfe\x00\x00'</span>:</span><br><span class="line">            encoding = <span class="string">'utf-32le'</span></span><br><span class="line">            data = data[<span class="number">4</span>:]</span><br><span class="line">        newdata = unicode(data, encoding)</span><br><span class="line">        <span class="keyword">return</span> newdata</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_detectEncoding</span><span class="params">(self, xml_data, isHTML=False)</span>:</span></span><br><span class="line">        <span class="string">"""Given a document, tries to detect its XML encoding."""</span></span><br><span class="line">        xml_encoding = sniffed_xml_encoding = <span class="keyword">None</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> xml_data[:<span class="number">4</span>] == <span class="string">'\x4c\x6f\xa7\x94'</span>:</span><br><span class="line">                <span class="comment"># EBCDIC</span></span><br><span class="line">                xml_data = self._ebcdic_to_ascii(xml_data)</span><br><span class="line">            <span class="keyword">elif</span> xml_data[:<span class="number">4</span>] == <span class="string">'\x00\x3c\x00\x3f'</span>:</span><br><span class="line">                <span class="comment"># UTF-16BE</span></span><br><span class="line">                sniffed_xml_encoding = <span class="string">'utf-16be'</span></span><br><span class="line">                xml_data = unicode(xml_data, <span class="string">'utf-16be'</span>).encode(<span class="string">'utf-8'</span>)</span><br><span class="line">            <span class="keyword">elif</span> (len(xml_data) &gt;= <span class="number">4</span>) <span class="keyword">and</span> (xml_data[:<span class="number">2</span>] == <span class="string">'\xfe\xff'</span>) \</span><br><span class="line">                     <span class="keyword">and</span> (xml_data[<span class="number">2</span>:<span class="number">4</span>] != <span class="string">'\x00\x00'</span>):</span><br><span class="line">                <span class="comment"># UTF-16BE with BOM</span></span><br><span class="line">                sniffed_xml_encoding = <span class="string">'utf-16be'</span></span><br><span class="line">                xml_data = unicode(xml_data[<span class="number">2</span>:], <span class="string">'utf-16be'</span>).encode(<span class="string">'utf-8'</span>)</span><br><span class="line">            <span class="keyword">elif</span> xml_data[:<span class="number">4</span>] == <span class="string">'\x3c\x00\x3f\x00'</span>:</span><br><span class="line">                <span class="comment"># UTF-16LE</span></span><br><span class="line">                sniffed_xml_encoding = <span class="string">'utf-16le'</span></span><br><span class="line">                xml_data = unicode(xml_data, <span class="string">'utf-16le'</span>).encode(<span class="string">'utf-8'</span>)</span><br><span class="line">            <span class="keyword">elif</span> (len(xml_data) &gt;= <span class="number">4</span>) <span class="keyword">and</span> (xml_data[:<span class="number">2</span>] == <span class="string">'\xff\xfe'</span>) <span class="keyword">and</span> \</span><br><span class="line">                     (xml_data[<span class="number">2</span>:<span class="number">4</span>] != <span class="string">'\x00\x00'</span>):</span><br><span class="line">                <span class="comment"># UTF-16LE with BOM</span></span><br><span class="line">                sniffed_xml_encoding = <span class="string">'utf-16le'</span></span><br><span class="line">                xml_data = unicode(xml_data[<span class="number">2</span>:], <span class="string">'utf-16le'</span>).encode(<span class="string">'utf-8'</span>)</span><br><span class="line">            <span class="keyword">elif</span> xml_data[:<span class="number">4</span>] == <span class="string">'\x00\x00\x00\x3c'</span>:</span><br><span class="line">                <span class="comment"># UTF-32BE</span></span><br><span class="line">                sniffed_xml_encoding = <span class="string">'utf-32be'</span></span><br><span class="line">                xml_data = unicode(xml_data, <span class="string">'utf-32be'</span>).encode(<span class="string">'utf-8'</span>)</span><br><span class="line">            <span class="keyword">elif</span> xml_data[:<span class="number">4</span>] == <span class="string">'\x3c\x00\x00\x00'</span>:</span><br><span class="line">                <span class="comment"># UTF-32LE</span></span><br><span class="line">                sniffed_xml_encoding = <span class="string">'utf-32le'</span></span><br><span class="line">                xml_data = unicode(xml_data, <span class="string">'utf-32le'</span>).encode(<span class="string">'utf-8'</span>)</span><br><span class="line">            <span class="keyword">elif</span> xml_data[:<span class="number">4</span>] == <span class="string">'\x00\x00\xfe\xff'</span>:</span><br><span class="line">                <span class="comment"># UTF-32BE with BOM</span></span><br><span class="line">                sniffed_xml_encoding = <span class="string">'utf-32be'</span></span><br><span class="line">                xml_data = unicode(xml_data[<span class="number">4</span>:], <span class="string">'utf-32be'</span>).encode(<span class="string">'utf-8'</span>)</span><br><span class="line">            <span class="keyword">elif</span> xml_data[:<span class="number">4</span>] == <span class="string">'\xff\xfe\x00\x00'</span>:</span><br><span class="line">                <span class="comment"># UTF-32LE with BOM</span></span><br><span class="line">                sniffed_xml_encoding = <span class="string">'utf-32le'</span></span><br><span class="line">                xml_data = unicode(xml_data[<span class="number">4</span>:], <span class="string">'utf-32le'</span>).encode(<span class="string">'utf-8'</span>)</span><br><span class="line">            <span class="keyword">elif</span> xml_data[:<span class="number">3</span>] == <span class="string">'\xef\xbb\xbf'</span>:</span><br><span class="line">                <span class="comment"># UTF-8 with BOM</span></span><br><span class="line">                sniffed_xml_encoding = <span class="string">'utf-8'</span></span><br><span class="line">                xml_data = unicode(xml_data[<span class="number">3</span>:], <span class="string">'utf-8'</span>).encode(<span class="string">'utf-8'</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                sniffed_xml_encoding = <span class="string">'ascii'</span></span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            xml_encoding_match = <span class="keyword">None</span></span><br><span class="line">        xml_encoding_match = re.compile(</span><br><span class="line">            <span class="string">'^&lt;\?.*encoding=[\'"](.*?)[\'"].*\?&gt;'</span>).match(xml_data)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> xml_encoding_match <span class="keyword">and</span> isHTML:</span><br><span class="line">            regexp = re.compile(<span class="string">'&lt;\s*meta[^&gt;]+charset=([^&gt;]*?)[;\'"&gt;]'</span>, re.I)</span><br><span class="line">            xml_encoding_match = regexp.search(xml_data)</span><br><span class="line">        <span class="keyword">if</span> xml_encoding_match <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:</span><br><span class="line">            xml_encoding = xml_encoding_match.groups()[<span class="number">0</span>].lower()</span><br><span class="line">            <span class="keyword">if</span> isHTML:</span><br><span class="line">                self.declaredHTMLEncoding = xml_encoding</span><br><span class="line">            <span class="keyword">if</span> sniffed_xml_encoding <span class="keyword">and</span> \</span><br><span class="line">               (xml_encoding <span class="keyword">in</span> (<span class="string">'iso-10646-ucs-2'</span>, <span class="string">'ucs-2'</span>, <span class="string">'csunicode'</span>,</span><br><span class="line">                                 <span class="string">'iso-10646-ucs-4'</span>, <span class="string">'ucs-4'</span>, <span class="string">'csucs4'</span>,</span><br><span class="line">                                 <span class="string">'utf-16'</span>, <span class="string">'utf-32'</span>, <span class="string">'utf_16'</span>, <span class="string">'utf_32'</span>,</span><br><span class="line">                                 <span class="string">'utf16'</span>, <span class="string">'u16'</span>)):</span><br><span class="line">                xml_encoding = sniffed_xml_encoding</span><br><span class="line">        <span class="keyword">return</span> xml_data, xml_encoding, sniffed_xml_encoding</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find_codec</span><span class="params">(self, charset)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._codec(self.CHARSET_ALIASES.get(charset, charset)) \</span><br><span class="line">               <span class="keyword">or</span> (charset <span class="keyword">and</span> self._codec(charset.replace(<span class="string">"-"</span>, <span class="string">""</span>))) \</span><br><span class="line">               <span class="keyword">or</span> (charset <span class="keyword">and</span> self._codec(charset.replace(<span class="string">"-"</span>, <span class="string">"_"</span>))) \</span><br><span class="line">               <span class="keyword">or</span> charset</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_codec</span><span class="params">(self, charset)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> charset: <span class="keyword">return</span> charset</span><br><span class="line">        codec = <span class="keyword">None</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            codecs.lookup(charset)</span><br><span class="line">            codec = charset</span><br><span class="line">        <span class="keyword">except</span> (LookupError, ValueError):</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">return</span> codec</span><br><span class="line"></span><br><span class="line">    EBCDIC_TO_ASCII_MAP = <span class="keyword">None</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_ebcdic_to_ascii</span><span class="params">(self, s)</span>:</span></span><br><span class="line">        c = self.__class__</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> c.EBCDIC_TO_ASCII_MAP:</span><br><span class="line">            emap = (<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">156</span>,<span class="number">9</span>,<span class="number">134</span>,<span class="number">127</span>,<span class="number">151</span>,<span class="number">141</span>,<span class="number">142</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,</span><br><span class="line">                    <span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">157</span>,<span class="number">133</span>,<span class="number">8</span>,<span class="number">135</span>,<span class="number">24</span>,<span class="number">25</span>,<span class="number">146</span>,<span class="number">143</span>,<span class="number">28</span>,<span class="number">29</span>,<span class="number">30</span>,<span class="number">31</span>,</span><br><span class="line">                    <span class="number">128</span>,<span class="number">129</span>,<span class="number">130</span>,<span class="number">131</span>,<span class="number">132</span>,<span class="number">10</span>,<span class="number">23</span>,<span class="number">27</span>,<span class="number">136</span>,<span class="number">137</span>,<span class="number">138</span>,<span class="number">139</span>,<span class="number">140</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,</span><br><span class="line">                    <span class="number">144</span>,<span class="number">145</span>,<span class="number">22</span>,<span class="number">147</span>,<span class="number">148</span>,<span class="number">149</span>,<span class="number">150</span>,<span class="number">4</span>,<span class="number">152</span>,<span class="number">153</span>,<span class="number">154</span>,<span class="number">155</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">158</span>,<span class="number">26</span>,</span><br><span class="line">                    <span class="number">32</span>,<span class="number">160</span>,<span class="number">161</span>,<span class="number">162</span>,<span class="number">163</span>,<span class="number">164</span>,<span class="number">165</span>,<span class="number">166</span>,<span class="number">167</span>,<span class="number">168</span>,<span class="number">91</span>,<span class="number">46</span>,<span class="number">60</span>,<span class="number">40</span>,<span class="number">43</span>,<span class="number">33</span>,</span><br><span class="line">                    <span class="number">38</span>,<span class="number">169</span>,<span class="number">170</span>,<span class="number">171</span>,<span class="number">172</span>,<span class="number">173</span>,<span class="number">174</span>,<span class="number">175</span>,<span class="number">176</span>,<span class="number">177</span>,<span class="number">93</span>,<span class="number">36</span>,<span class="number">42</span>,<span class="number">41</span>,<span class="number">59</span>,<span class="number">94</span>,</span><br><span class="line">                    <span class="number">45</span>,<span class="number">47</span>,<span class="number">178</span>,<span class="number">179</span>,<span class="number">180</span>,<span class="number">181</span>,<span class="number">182</span>,<span class="number">183</span>,<span class="number">184</span>,<span class="number">185</span>,<span class="number">124</span>,<span class="number">44</span>,<span class="number">37</span>,<span class="number">95</span>,<span class="number">62</span>,<span class="number">63</span>,</span><br><span class="line">                    <span class="number">186</span>,<span class="number">187</span>,<span class="number">188</span>,<span class="number">189</span>,<span class="number">190</span>,<span class="number">191</span>,<span class="number">192</span>,<span class="number">193</span>,<span class="number">194</span>,<span class="number">96</span>,<span class="number">58</span>,<span class="number">35</span>,<span class="number">64</span>,<span class="number">39</span>,<span class="number">61</span>,<span class="number">34</span>,</span><br><span class="line">                    <span class="number">195</span>,<span class="number">97</span>,<span class="number">98</span>,<span class="number">99</span>,<span class="number">100</span>,<span class="number">101</span>,<span class="number">102</span>,<span class="number">103</span>,<span class="number">104</span>,<span class="number">105</span>,<span class="number">196</span>,<span class="number">197</span>,<span class="number">198</span>,<span class="number">199</span>,<span class="number">200</span>,</span><br><span class="line">                    <span class="number">201</span>,<span class="number">202</span>,<span class="number">106</span>,<span class="number">107</span>,<span class="number">108</span>,<span class="number">109</span>,<span class="number">110</span>,<span class="number">111</span>,<span class="number">112</span>,<span class="number">113</span>,<span class="number">114</span>,<span class="number">203</span>,<span class="number">204</span>,<span class="number">205</span>,</span><br><span class="line">                    <span class="number">206</span>,<span class="number">207</span>,<span class="number">208</span>,<span class="number">209</span>,<span class="number">126</span>,<span class="number">115</span>,<span class="number">116</span>,<span class="number">117</span>,<span class="number">118</span>,<span class="number">119</span>,<span class="number">120</span>,<span class="number">121</span>,<span class="number">122</span>,<span class="number">210</span>,</span><br><span class="line">                    <span class="number">211</span>,<span class="number">212</span>,<span class="number">213</span>,<span class="number">214</span>,<span class="number">215</span>,<span class="number">216</span>,<span class="number">217</span>,<span class="number">218</span>,<span class="number">219</span>,<span class="number">220</span>,<span class="number">221</span>,<span class="number">222</span>,<span class="number">223</span>,<span class="number">224</span>,</span><br><span class="line">                    <span class="number">225</span>,<span class="number">226</span>,<span class="number">227</span>,<span class="number">228</span>,<span class="number">229</span>,<span class="number">230</span>,<span class="number">231</span>,<span class="number">123</span>,<span class="number">65</span>,<span class="number">66</span>,<span class="number">67</span>,<span class="number">68</span>,<span class="number">69</span>,<span class="number">70</span>,<span class="number">71</span>,<span class="number">72</span>,</span><br><span class="line">                    <span class="number">73</span>,<span class="number">232</span>,<span class="number">233</span>,<span class="number">234</span>,<span class="number">235</span>,<span class="number">236</span>,<span class="number">237</span>,<span class="number">125</span>,<span class="number">74</span>,<span class="number">75</span>,<span class="number">76</span>,<span class="number">77</span>,<span class="number">78</span>,<span class="number">79</span>,<span class="number">80</span>,<span class="number">81</span>,</span><br><span class="line">                    <span class="number">82</span>,<span class="number">238</span>,<span class="number">239</span>,<span class="number">240</span>,<span class="number">241</span>,<span class="number">242</span>,<span class="number">243</span>,<span class="number">92</span>,<span class="number">159</span>,<span class="number">83</span>,<span class="number">84</span>,<span class="number">85</span>,<span class="number">86</span>,<span class="number">87</span>,<span class="number">88</span>,<span class="number">89</span>,</span><br><span class="line">                    <span class="number">90</span>,<span class="number">244</span>,<span class="number">245</span>,<span class="number">246</span>,<span class="number">247</span>,<span class="number">248</span>,<span class="number">249</span>,<span class="number">48</span>,<span class="number">49</span>,<span class="number">50</span>,<span class="number">51</span>,<span class="number">52</span>,<span class="number">53</span>,<span class="number">54</span>,<span class="number">55</span>,<span class="number">56</span>,<span class="number">57</span>,</span><br><span class="line">                    <span class="number">250</span>,<span class="number">251</span>,<span class="number">252</span>,<span class="number">253</span>,<span class="number">254</span>,<span class="number">255</span>)</span><br><span class="line">            <span class="keyword">import</span> string</span><br><span class="line">            c.EBCDIC_TO_ASCII_MAP = string.maketrans( \</span><br><span class="line">            <span class="string">''</span>.join(map(chr, range(<span class="number">256</span>))), <span class="string">''</span>.join(map(chr, emap)))</span><br><span class="line">        <span class="keyword">return</span> s.translate(c.EBCDIC_TO_ASCII_MAP)</span><br><span class="line"></span><br><span class="line">    MS_CHARS = &#123; <span class="string">'\x80'</span> : (<span class="string">'euro'</span>, <span class="string">'20AC'</span>),</span><br><span class="line">                 <span class="string">'\x81'</span> : <span class="string">' '</span>,</span><br><span class="line">                 <span class="string">'\x82'</span> : (<span class="string">'sbquo'</span>, <span class="string">'201A'</span>),</span><br><span class="line">                 <span class="string">'\x83'</span> : (<span class="string">'fnof'</span>, <span class="string">'192'</span>),</span><br><span class="line">                 <span class="string">'\x84'</span> : (<span class="string">'bdquo'</span>, <span class="string">'201E'</span>),</span><br><span class="line">                 <span class="string">'\x85'</span> : (<span class="string">'hellip'</span>, <span class="string">'2026'</span>),</span><br><span class="line">                 <span class="string">'\x86'</span> : (<span class="string">'dagger'</span>, <span class="string">'2020'</span>),</span><br><span class="line">                 <span class="string">'\x87'</span> : (<span class="string">'Dagger'</span>, <span class="string">'2021'</span>),</span><br><span class="line">                 <span class="string">'\x88'</span> : (<span class="string">'circ'</span>, <span class="string">'2C6'</span>),</span><br><span class="line">                 <span class="string">'\x89'</span> : (<span class="string">'permil'</span>, <span class="string">'2030'</span>),</span><br><span class="line">                 <span class="string">'\x8A'</span> : (<span class="string">'Scaron'</span>, <span class="string">'160'</span>),</span><br><span class="line">                 <span class="string">'\x8B'</span> : (<span class="string">'lsaquo'</span>, <span class="string">'2039'</span>),</span><br><span class="line">                 <span class="string">'\x8C'</span> : (<span class="string">'OElig'</span>, <span class="string">'152'</span>),</span><br><span class="line">                 <span class="string">'\x8D'</span> : <span class="string">'?'</span>,</span><br><span class="line">                 <span class="string">'\x8E'</span> : (<span class="string">'#x17D'</span>, <span class="string">'17D'</span>),</span><br><span class="line">                 <span class="string">'\x8F'</span> : <span class="string">'?'</span>,</span><br><span class="line">                 <span class="string">'\x90'</span> : <span class="string">'?'</span>,</span><br><span class="line">                 <span class="string">'\x91'</span> : (<span class="string">'lsquo'</span>, <span class="string">'2018'</span>),</span><br><span class="line">                 <span class="string">'\x92'</span> : (<span class="string">'rsquo'</span>, <span class="string">'2019'</span>),</span><br><span class="line">                 <span class="string">'\x93'</span> : (<span class="string">'ldquo'</span>, <span class="string">'201C'</span>),</span><br><span class="line">                 <span class="string">'\x94'</span> : (<span class="string">'rdquo'</span>, <span class="string">'201D'</span>),</span><br><span class="line">                 <span class="string">'\x95'</span> : (<span class="string">'bull'</span>, <span class="string">'2022'</span>),</span><br><span class="line">                 <span class="string">'\x96'</span> : (<span class="string">'ndash'</span>, <span class="string">'2013'</span>),</span><br><span class="line">                 <span class="string">'\x97'</span> : (<span class="string">'mdash'</span>, <span class="string">'2014'</span>),</span><br><span class="line">                 <span class="string">'\x98'</span> : (<span class="string">'tilde'</span>, <span class="string">'2DC'</span>),</span><br><span class="line">                 <span class="string">'\x99'</span> : (<span class="string">'trade'</span>, <span class="string">'2122'</span>),</span><br><span class="line">                 <span class="string">'\x9a'</span> : (<span class="string">'scaron'</span>, <span class="string">'161'</span>),</span><br><span class="line">                 <span class="string">'\x9b'</span> : (<span class="string">'rsaquo'</span>, <span class="string">'203A'</span>),</span><br><span class="line">                 <span class="string">'\x9c'</span> : (<span class="string">'oelig'</span>, <span class="string">'153'</span>),</span><br><span class="line">                 <span class="string">'\x9d'</span> : <span class="string">'?'</span>,</span><br><span class="line">                 <span class="string">'\x9e'</span> : (<span class="string">'#x17E'</span>, <span class="string">'17E'</span>),</span><br><span class="line">                 <span class="string">'\x9f'</span> : (<span class="string">'Yuml'</span>, <span class="string">''</span>),&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#By default, act as an HTML pretty-printer.</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">import</span> sys</span><br><span class="line">    soup = BeautifulSoup(sys.stdin)</span><br><span class="line">    <span class="keyword">print</span> soup.prettify()</span><br></pre></td></tr></table></figure></p>

    
  </div>

</article>

   <br>
   <br>

   

   
  <div class="box-prev-next clearfix">
    <a class="show pull-left" href="/Python/000107-简明Python教程-15.更多Python的内容/">
        <i class="icon icon-angle-left"></i>
    </a>
    <a class="show pull-right" href="/Python/000109-Python脚本寻人/">
        <i class="icon icon-angle-right"></i>
    </a>
  </div>




</div>


  <a id="backTop" class="back-top">
    <i class="icon-angle-up"></i>
  </a>




  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">关闭</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/search/" rel="noopener noreferrer" target="_self">
              搜索
            </a>
          </li>
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/category/" rel="noopener noreferrer" target="_self">
              分类
            </a>
          </li>
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/tag/" rel="noopener noreferrer" target="_self">
              标签
            </a>
          </li>
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/link/" rel="noopener noreferrer" target="_self">
              友链
            </a>
          </li>
        
          <li class="item-toolbox">
            <a class="CIRCLE" href="/about/" rel="noopener noreferrer" target="_self">
              关于
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-post">
    

    

    
    

    

    
    

    

  </div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script>

</body>
</html>
